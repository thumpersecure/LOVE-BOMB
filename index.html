<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="love-bomb-variations.js"></script>
<title>You've Been Love Bombed ðŸ’Œ</title>
<meta name="description" content="Someone just sent you a love bomb â€” a personal love telegram meant only for you. Open it.">
<meta property="og:title" content="You've Been Love Bombed ðŸ’Œ">
<meta property="og:description" content="Someone sent you a love bomb. Open it.">
<meta property="og:type" content="website">
<meta property="og:image" content="https://thumpersecure.github.io/LOVE-BOMB/assets/social-preview.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:url" content="https://thumpersecure.github.io/LOVE-BOMB/">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="You've Been Love Bombed ðŸ’Œ">
<meta name="twitter:description" content="Someone sent you a love bomb. Open it.">
<meta name="twitter:image" content="https://thumpersecure.github.io/LOVE-BOMB/assets/social-preview.png">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Inter:wght@300;400;500&family=Special+Elite&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
html{scroll-behavior:smooth}
body{
  background:#0d0212;
  color:#fff;
  font-family:'Inter',sans-serif;
  overflow-x:hidden;
  min-height:100vh;
}

/* â”€â”€ Starfield Canvas â”€â”€ */
#star-canvas{
  position:fixed;top:0;left:0;width:100%;height:100%;
  z-index:0;pointer-events:none;
}

/* â”€â”€ Heart Canvas â”€â”€ */
#heart-canvas{
  position:fixed;top:0;left:0;width:100%;height:100%;
  z-index:1;pointer-events:none;
}

/* â”€â”€ Aurora Overlay â”€â”€ */
.aurora-overlay{
  position:fixed;top:0;left:0;width:100%;height:100%;
  z-index:0;pointer-events:none;
  background:
    radial-gradient(ellipse 80% 50% at 20% 80%, rgba(255,105,180,0.06) 0%, transparent 70%),
    radial-gradient(ellipse 60% 40% at 80% 20%, rgba(180,60,255,0.05) 0%, transparent 70%),
    radial-gradient(ellipse 70% 60% at 50% 50%, rgba(255,20,147,0.03) 0%, transparent 70%);
  animation:aurora-shift 12s ease-in-out infinite alternate;
}
@keyframes aurora-shift{
  0%{opacity:0.6;filter:hue-rotate(0deg)}
  50%{opacity:1;filter:hue-rotate(15deg)}
  100%{opacity:0.7;filter:hue-rotate(-10deg)}
}

/* â”€â”€ Content Overlay â”€â”€ */
.content{
  position:relative;z-index:2;
  max-width:720px;margin:0 auto;padding:40px 24px;
  text-align:center;
}

/* â”€â”€ Sections â”€â”€ */
.section{
  margin:80px 0;
  opacity:0;transform:translateY(40px);
  transition:opacity 1.2s ease,transform 1.2s ease;
}
.section.visible{opacity:1;transform:translateY(0)}
.section#s1{margin-top:15vh}
.section#variation-picker{margin-top:10vh}

/* â”€â”€ Typography â”€â”€ */
h1{
  font-family:'Playfair Display',serif;
  font-size:clamp(2.4rem,6vw,4rem);
  font-weight:700;
  line-height:1.15;
  margin-bottom:16px;
  background:linear-gradient(135deg,#fff 0%,#ffb6c1 40%,#ff69b4 70%,#fff 100%);
  background-size:200% 200%;
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
  animation:shimmer-text 4s ease-in-out infinite;
}
@keyframes shimmer-text{
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}
h2{
  font-family:'Playfair Display',serif;
  font-size:clamp(1.6rem,4vw,2.4rem);
  font-weight:400;font-style:italic;
  color:#ffb6c1;
  margin-bottom:24px;
}
p,.quote{
  font-size:clamp(1rem,2.5vw,1.15rem);
  line-height:1.8;
  color:#e0c0d0;
  font-weight:300;
  margin-bottom:20px;
}
.quote{
  border-left:3px solid #ff69b4;
  padding:16px 24px;
  margin:32px auto;
  max-width:520px;
  text-align:left;
  font-style:italic;
  background:rgba(255,105,180,0.05);
  border-radius:0 12px 12px 0;
  position:relative;
}
.quote::after{
  content:'';
  position:absolute;top:0;left:0;width:3px;height:100%;
  background:linear-gradient(180deg,#ff69b4,#c71585,#ff69b4);
  animation:quote-glow 3s ease-in-out infinite;
}
@keyframes quote-glow{
  0%,100%{box-shadow:0 0 8px rgba(255,105,180,0.4)}
  50%{box-shadow:0 0 20px rgba(255,105,180,0.8)}
}

/* â”€â”€ Telegram Frame â”€â”€ */
.telegram-frame{
  border:2px solid rgba(255,105,180,0.3);
  border-radius:20px;
  padding:40px 32px;
  margin:32px auto;
  max-width:560px;
  background:rgba(255,105,180,0.03);
  backdrop-filter:blur(12px);
  position:relative;
  animation:frame-glow 5s ease-in-out infinite;
}
@keyframes frame-glow{
  0%,100%{box-shadow:0 0 15px rgba(255,105,180,0.08),inset 0 0 15px rgba(255,105,180,0.03)}
  50%{box-shadow:0 0 30px rgba(255,105,180,0.15),inset 0 0 30px rgba(255,105,180,0.06)}
}
.telegram-frame::before{
  content:'LOVE BOMB';
  position:absolute;top:-14px;left:50%;transform:translateX(-50%);
  background:#0d0212;
  padding:0 16px;
  font-family:'Special Elite',cursive;
  font-size:0.85rem;
  letter-spacing:4px;
  color:#ff69b4;
  text-shadow:0 0 10px rgba(255,105,180,0.5);
}
.telegram-header{
  font-family:'Special Elite',cursive;
  font-size:0.85rem;
  color:#a07888;
  text-align:left;
  margin-bottom:20px;
  line-height:2;
  letter-spacing:1px;
}
.telegram-header span{
  color:#ffb6c1;
}
.telegram-body{
  font-family:'Playfair Display',serif;
  font-size:clamp(1.1rem,3vw,1.35rem);
  color:#fff;
  line-height:1.9;
  text-align:left;
  font-style:italic;
}
.telegram-body .love-word{
  color:#ff69b4;
  font-weight:700;
  font-style:normal;
  text-shadow:0 0 8px rgba(255,105,180,0.3);
}
.telegram-stamp{
  margin-top:24px;
  text-align:right;
  font-family:'Special Elite',cursive;
  font-size:0.8rem;
  color:#a07888;
  letter-spacing:2px;
}

/* â”€â”€ Love Affirmation Cards â”€â”€ */
.affirmation-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:16px;
  max-width:520px;
  margin:32px auto;
}
.affirmation-card{
  background:rgba(255,105,180,0.04);
  border:1px solid rgba(255,105,180,0.15);
  border-radius:16px;
  padding:20px 16px;
  transition:all 0.4s ease;
  position:relative;
  overflow:hidden;
}
.affirmation-card::before{
  content:'';
  position:absolute;top:-50%;left:-50%;width:200%;height:200%;
  background:radial-gradient(circle,rgba(255,105,180,0.08) 0%,transparent 60%);
  opacity:0;
  transition:opacity 0.5s ease;
}
.affirmation-card:hover::before{opacity:1}
.affirmation-card:hover{
  border-color:rgba(255,105,180,0.4);
  transform:translateY(-2px);
  box-shadow:0 8px 24px rgba(255,105,180,0.1);
}
.affirmation-emoji{font-size:1.6rem;margin-bottom:8px;display:block}
.affirmation-text{
  font-family:'Playfair Display',serif;
  font-size:0.95rem;
  color:#e0c0d0;
  font-style:italic;
  line-height:1.5;
}

/* â”€â”€ Glow Equation (small, subtle) â”€â”€ */
.equation{
  font-family:'Playfair Display',serif;
  font-size:clamp(1.4rem,3.5vw,2rem);
  font-weight:700;
  color:#fff;
  text-shadow:
    0 0 20px rgba(255,105,180,0.8),
    0 0 40px rgba(255,105,180,0.5),
    0 0 80px rgba(255,105,180,0.3);
  margin:24px 0;
  animation:glow-pulse 3s ease-in-out infinite;
}
@keyframes glow-pulse{
  0%,100%{text-shadow:0 0 20px rgba(255,105,180,0.8),0 0 40px rgba(255,105,180,0.5),0 0 80px rgba(255,105,180,0.3)}
  50%{text-shadow:0 0 30px rgba(255,105,180,1),0 0 60px rgba(255,105,180,0.7),0 0 120px rgba(255,105,180,0.5)}
}

/* â”€â”€ Big Love Declaration â”€â”€ */
.love-declaration{
  font-family:'Playfair Display',serif;
  font-size:clamp(2rem,5.5vw,3.6rem);
  font-weight:700;
  background:linear-gradient(135deg,#ff69b4,#ff1493,#c71585,#ff69b4);
  background-size:300% 300%;
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
  animation:love-gradient 4s ease-in-out infinite;
  text-shadow:none;
  margin:40px 0;
  filter:drop-shadow(0 0 20px rgba(255,105,180,0.4));
}
@keyframes love-gradient{
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}

/* â”€â”€ Counter â”€â”€ */
.counter-box{
  display:inline-flex;align-items:center;gap:10px;
  background:rgba(255,105,180,0.08);
  border:1px solid rgba(255,105,180,0.2);
  border-radius:40px;
  padding:10px 24px;
  margin:20px 0;
  font-family:'Special Elite',cursive;
  font-size:0.95rem;
  color:#ffb6c1;
  letter-spacing:1px;
}
.counter-box .counter-num{
  color:#ff69b4;
  font-size:1.1rem;
  font-weight:700;
  min-width:50px;
}
.counter-pulse{
  width:8px;height:8px;border-radius:50%;
  background:#ff69b4;
  animation:counter-blink 2s ease-in-out infinite;
}
@keyframes counter-blink{
  0%,100%{opacity:0.3;box-shadow:none}
  50%{opacity:1;box-shadow:0 0 8px #ff69b4}
}

/* â”€â”€ Emphasis â”€â”€ */
.love-word{color:#ff69b4;font-weight:500;text-shadow:0 0 6px rgba(255,105,180,0.2)}
em{color:#ffb6c1}
strong{color:#fff;font-weight:500}

/* â”€â”€ Heart Divider â”€â”€ */
.heart-divider{
  margin:48px auto;font-size:1.4rem;
  letter-spacing:12px;color:#ff69b4;
  opacity:0.6;
  animation:divider-twinkle 4s ease-in-out infinite;
}
@keyframes divider-twinkle{
  0%,100%{opacity:0.4;letter-spacing:12px}
  50%{opacity:0.8;letter-spacing:16px}
}

/* â”€â”€ Video Container â”€â”€ */
.video-section{
  background:rgba(255,105,180,0.08);
  border:1px solid rgba(255,105,180,0.2);
  border-radius:24px;
  padding:40px 32px;
  margin:48px auto;
  max-width:480px;
  backdrop-filter:blur(20px);
  position:relative;
  overflow:hidden;
}
.video-section::before{
  content:'';
  position:absolute;top:-2px;left:-2px;right:-2px;bottom:-2px;
  background:linear-gradient(135deg,rgba(255,105,180,0.2),transparent,rgba(180,60,255,0.2));
  border-radius:25px;
  z-index:-1;
  animation:video-border-glow 4s ease-in-out infinite alternate;
}
@keyframes video-border-glow{
  0%{opacity:0.3}
  100%{opacity:0.8}
}
.video-section h3{
  font-family:'Playfair Display',serif;
  font-size:1.3rem;
  color:#ffb6c1;
  margin-bottom:8px;
}
.video-section .subtitle{
  font-size:0.85rem;color:#c090a8;margin-bottom:24px;
}
.yt-container{
  margin-top:24px;border-radius:16px;overflow:hidden;
  display:none;
  box-shadow:0 0 40px rgba(255,105,180,0.2);
  position:relative;
}
.yt-container.active{display:block;animation:fade-in 0.8s ease}
.yt-container iframe{width:100%;aspect-ratio:16/9;border:none;display:block}
.unmute-overlay{
  position:absolute;bottom:12px;right:12px;
  z-index:10;
}
.unmute-btn{
  padding:10px 20px;
  background:rgba(13,2,18,0.9);
  border:1px solid rgba(255,105,180,0.5);
  border-radius:24px;
  color:#ffb6c1;
  font-family:'Inter',sans-serif;
  font-size:0.9rem;
  cursor:pointer;
  transition:all 0.3s ease;
  display:flex;align-items:center;gap:8px;
}
.unmute-btn:hover{
  background:rgba(255,105,180,0.3);
  border-color:#ff69b4;
  color:#fff;
}
.unmute-btn .unmute-label{white-space:nowrap}
@keyframes fade-in{from{opacity:0;transform:scale(0.95)}to{opacity:1;transform:scale(1)}}

/* â”€â”€ Tap to hear overlay â”€â”€ */
.tap-to-hear{
  position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
  background:rgba(255,105,180,0.15);
  border:1px solid rgba(255,105,180,0.3);
  border-radius:50%;
  width:80px;height:80px;
  display:flex;align-items:center;justify-content:center;
  font-size:1.8rem;
  cursor:pointer;
  z-index:10;
  animation:tap-pulse 2s ease-in-out infinite;
  transition:all 0.3s ease;
  backdrop-filter:blur(8px);
}
.tap-to-hear:hover{
  background:rgba(255,105,180,0.3);
  transform:translate(-50%,-50%) scale(1.1);
}
.tap-to-hear.hidden{display:none}
@keyframes tap-pulse{
  0%,100%{box-shadow:0 0 10px rgba(255,105,180,0.3)}
  50%{box-shadow:0 0 30px rgba(255,105,180,0.6)}
}

/* â”€â”€ Unmute Overlay (ad-aware countdown) â”€â”€ */
.unmute-overlay{
  position:absolute;bottom:12px;right:12px;
  z-index:10;
}
.unmute-btn{
  padding:10px 20px;
  background:rgba(13,2,18,0.9);
  border:1px solid rgba(255,105,180,0.5);
  border-radius:24px;
  color:#ffb6c1;
  font-family:'Inter',sans-serif;
  font-size:0.9rem;
  cursor:pointer;
  transition:all 0.3s ease;
  display:flex;align-items:center;gap:8px;
}
.unmute-btn:hover:not(:disabled){
  background:rgba(255,105,180,0.3);
  border-color:#ff69b4;
  color:#fff;
}
.unmute-btn:disabled{
  cursor:not-allowed;
  opacity:0.85;
}
.unmute-btn.ready{
  background:rgba(255,105,180,0.2);
  animation:unmute-ready-glow 1.5s ease-in-out infinite;
}
@keyframes unmute-ready-glow{
  0%,100%{box-shadow:0 0 8px rgba(255,105,180,0.3)}
  50%{box-shadow:0 0 20px rgba(255,105,180,0.6)}
}
.unmute-btn .unmute-label{white-space:nowrap}
.haptics-status{
  margin-top:12px;
  min-height:1.2em;
  font-size:0.78rem;
  color:#a88998;
  opacity:0;
  transition:opacity 0.25s ease;
}
.haptics-status.visible{opacity:1}

/* â”€â”€ Share â”€â”€ */
.share-btn{
  display:inline-flex;align-items:center;gap:10px;
  background:linear-gradient(135deg,#ff69b4,#ff1493,#c71585);
  border:none;
  color:#fff;border-radius:60px;
  padding:16px 36px;font-size:1.05rem;
  font-family:'Inter',sans-serif;font-weight:500;
  cursor:pointer;transition:all 0.3s ease;
  box-shadow:0 0 30px rgba(255,105,180,0.4),0 4px 20px rgba(0,0,0,0.3);
  animation:btn-breathe 2.5s ease-in-out infinite;
  position:relative;
  overflow:hidden;
}
.share-btn::before{
  content:'';
  position:absolute;top:-50%;left:-50%;width:200%;height:200%;
  background:linear-gradient(45deg,transparent 30%,rgba(255,255,255,0.1) 50%,transparent 70%);
  animation:btn-shine 3s ease-in-out infinite;
}
@keyframes btn-shine{
  0%{transform:translateX(-100%) rotate(45deg)}
  100%{transform:translateX(100%) rotate(45deg)}
}
.share-btn:hover{
  transform:scale(1.05);
  box-shadow:0 0 50px rgba(255,105,180,0.6),0 6px 30px rgba(0,0,0,0.4);
}
@keyframes btn-breathe{
  0%,100%{box-shadow:0 0 30px rgba(255,105,180,0.4),0 4px 20px rgba(0,0,0,0.3)}
  50%{box-shadow:0 0 50px rgba(255,105,180,0.6),0 4px 20px rgba(0,0,0,0.3)}
}

.share-link-btn{
  display:inline-flex;align-items:center;gap:10px;
  background:transparent;
  border:2px solid rgba(255,105,180,0.5);
  color:#ffb6c1;border-radius:60px;
  padding:14px 32px;font-size:1rem;
  font-family:'Inter',sans-serif;font-weight:400;
  cursor:pointer;transition:all 0.3s ease;
}
.share-link-btn:hover{
  background:rgba(255,105,180,0.15);
  border-color:#ff69b4;color:#fff;
  box-shadow:0 0 30px rgba(255,105,180,0.2);
}

/* â”€â”€ Variation Picker â”€â”€ */
.variation-btns{
  display:flex;flex-wrap:wrap;gap:8px;justify-content:center;
}
.top-controls{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  justify-content:center;
  align-items:center;
  margin-top:10px;
}
.mode-toggle{
  padding:8px 14px;
  font-size:0.82rem;
  background:rgba(255,255,255,0.06);
  border:1px solid rgba(255,255,255,0.14);
  border-radius:999px;
  color:#ffe6f0;
  cursor:pointer;
  transition:transform 0.15s ease, background 0.2s ease, border-color 0.2s ease;
  font-family:'Inter',sans-serif;
  min-height:40px;
}
.mode-toggle:hover{transform:translateY(-1px);background:rgba(255,255,255,0.09);border-color:rgba(255,255,255,0.22)}
.mode-toggle.active{
  background:linear-gradient(135deg,rgba(var(--accent),0.28),rgba(255,255,255,0.08));
  border-color:rgba(var(--accent),0.55);
  color:#fff;
}
.variation-btn{
  padding:8px 16px;
  font-size:0.85rem;
  background:rgba(255,105,180,0.1);
  border:1px solid rgba(255,105,180,0.3);
  border-radius:20px;
  color:#ffb6c1;
  cursor:pointer;
  transition:all 0.25s ease;
  font-family:'Inter',sans-serif;
}
.variation-btn:hover{
  background:rgba(255,105,180,0.2);
  border-color:#ff69b4;
  color:#fff;
}
.variation-btn.active{
  background:linear-gradient(135deg,rgba(255,105,180,0.4),rgba(255,20,147,0.3));
  border-color:#ff69b4;
  color:#fff;
}

/* â”€â”€ Floating Sparkles â”€â”€ */
.sparkle{
  position:fixed;pointer-events:none;z-index:3;
  width:4px;height:4px;border-radius:50%;
  background:#ff69b4;
  animation:sparkle-float 3s ease-out forwards;
}
@keyframes sparkle-float{
  0%{opacity:1;transform:scale(1) translateY(0)}
  100%{opacity:0;transform:scale(0) translateY(-60px)}
}

/* â”€â”€ Magical Shimmer on visible sections â”€â”€ */
.section.visible .telegram-frame,
.section.visible .affirmation-card{
  animation:enchanted-entrance 1s ease forwards;
}
@keyframes enchanted-entrance{
  0%{filter:brightness(1)}
  30%{filter:brightness(1.2)}
  100%{filter:brightness(1)}
}

/* â”€â”€ Floating Magical Orbs â”€â”€ */
.magic-orb{
  position:fixed;pointer-events:none;z-index:1;
  border-radius:50%;
  background:radial-gradient(circle,rgba(255,105,180,0.3) 0%,transparent 70%);
  animation:orb-float 8s ease-in-out infinite;
}
@keyframes orb-float{
  0%,100%{transform:translate(0,0) scale(1);opacity:0.3}
  25%{transform:translate(30px,-20px) scale(1.2);opacity:0.5}
  50%{transform:translate(-20px,-40px) scale(0.9);opacity:0.4}
  75%{transform:translate(10px,-10px) scale(1.1);opacity:0.3}
}

/* â”€â”€ Responsive â”€â”€ */
@media(max-width:768px){
  .section{margin:56px 0}
  .heart-divider{letter-spacing:8px;font-size:1.2rem}
  @keyframes divider-twinkle{
    0%,100%{opacity:0.4;letter-spacing:8px}
    50%{opacity:0.8;letter-spacing:10px}
  }
  .love-ripple-container{height:100px}
  @keyframes ripple-expand{
    0%{width:16px;height:16px;opacity:0.8}
    100%{width:140px;height:140px;opacity:0}
  }
  .quote{max-width:100%}
}
@media(max-width:600px){
  .content{padding:24px 16px;padding-bottom:calc(24px + env(safe-area-inset-bottom,0px))}
  .section{margin:40px 0}
  .section#s1{margin-top:10vh}
  .telegram-frame{padding:24px 16px}
  .video-section{padding:24px 16px}
  .share-btn{padding:14px 24px;font-size:0.95rem;width:100%;justify-content:center}
  .share-link-btn{padding:14px 24px;font-size:0.95rem;width:100%;justify-content:center}
  .variation-btn{padding:10px 14px;font-size:0.82rem;min-height:44px;display:inline-flex;align-items:center}
  .variation-btns{gap:6px}
  .affirmation-grid{grid-template-columns:1fr;gap:12px}
  .affirmation-card{padding:16px 14px}
  .counter-box{padding:8px 16px;font-size:0.85rem;flex-wrap:wrap;justify-content:center}
  .unmute-overlay{left:12px;right:12px;bottom:12px}
  .unmute-btn{padding:12px 20px;min-height:44px;width:100%;justify-content:center}
  .tap-to-hear{width:64px;height:64px;font-size:1.4rem}
  .heart-divider{margin:32px auto;letter-spacing:6px;font-size:1.1rem}
  @keyframes divider-twinkle{
    0%,100%{opacity:0.4;letter-spacing:6px}
    50%{opacity:0.8;letter-spacing:8px}
  }
  .love-ripple-container{height:80px}
  @keyframes ripple-expand{
    0%{width:14px;height:14px;opacity:0.8}
    100%{width:100px;height:100px;opacity:0}
  }
  .breathing-heart{font-size:2rem}
  .from-banner{font-size:0.75rem;letter-spacing:1px}
  .love-timestamp{font-size:0.7rem;letter-spacing:1px}
}
/* â”€â”€ Mobile-first mode (touch devices / forced mobile) â”€â”€ */
body.mobile-version{
  min-height:calc(var(--app-vh,1vh) * 100);
  -webkit-text-size-adjust:100%;
  overscroll-behavior-y:contain;
}
body.mobile-version .content{
  max-width:100%;
  padding-left:max(16px,env(safe-area-inset-left,0px));
  padding-right:max(16px,env(safe-area-inset-right,0px));
  transition:transform 0.12s ease;
}
body.mobile-version.beat-pulse .content{transform:scale(0.998)}
body.mobile-version .variation-btns{
  display:grid;
  grid-template-columns:repeat(2,minmax(0,1fr));
  width:100%;
}
body.mobile-version .variation-btn{width:100%;justify-content:center}
body.mobile-version .video-section{max-width:100%}
body.mobile-version .unmute-overlay{left:12px;right:12px;bottom:12px}
body.mobile-version .unmute-btn{width:100%;justify-content:center}
@media(max-width:420px){
  body.mobile-version .variation-btns{grid-template-columns:1fr}
}
/* â”€â”€ Safe areas for notched phones â”€â”€ */
@supports(padding:env(safe-area-inset-bottom)){
  .haptic-pulse{bottom:calc(20px + env(safe-area-inset-bottom))}
  .content{padding-bottom:calc(24px + env(safe-area-inset-bottom))}
}

/* â”€â”€ Philly LOVE Sculpture â”€â”€ */
.love-sculpture-wrap{
  display:none;
  margin:30px auto;
  text-align:center;
}
.love-sculpture-wrap.active{
  display:block;
  animation:sculpture-entrance 1s ease forwards;
}
@keyframes sculpture-entrance{
  0%{opacity:0;transform:scale(0.4) rotate(-15deg)}
  60%{opacity:1;transform:scale(1.05) rotate(2deg)}
  100%{opacity:1;transform:scale(1) rotate(0deg)}
}
.love-sculpture{
  display:inline-grid;
  grid-template-columns:1fr 1fr;
  font-family:Georgia,'Times New Roman',serif;
  font-weight:900;
  font-size:clamp(3.5rem,12vw,7rem);
  line-height:0.82;
  letter-spacing:-0.03em;
  color:#ff1493;
  text-shadow:0 0 20px rgba(255,20,147,0.5),0 0 40px rgba(255,20,147,0.3);
  animation:sculpture-glow 3s ease-in-out infinite;
}
@keyframes sculpture-glow{
  0%,100%{filter:drop-shadow(0 0 15px rgba(255,20,147,0.4))}
  50%{filter:drop-shadow(0 0 35px rgba(255,20,147,0.8))}
}
.love-sculpture span{
  display:flex;align-items:center;justify-content:center;
}
.love-sculpture .sculpture-o{
  transform:rotate(-28deg) translate(-4%,10%);
  color:#ff69b4;
}

/* â”€â”€ Star Wars-ish Love Scene (original graphics) â”€â”€ */
.starwars-scene{
  display:none;
  margin:28px auto 10px;
  max-width:560px;
  padding:18px 14px 16px;
  border-radius:18px;
  border:1px solid rgba(var(--accent),0.22);
  background:radial-gradient(ellipse 120% 90% at 50% 20%, rgba(var(--accent),0.10), rgba(13,2,18,0.0) 55%),
             linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
  position:relative;
  overflow:hidden;
}
.starwars-scene.active{display:block}
.starwars-scene .scene-title{
  font-family:'Special Elite',cursive;
  font-size:0.78rem;
  letter-spacing:2px;
  color:rgba(255,255,255,0.72);
  margin-bottom:10px;
}
.starwars-scene .scene-sub{
  font-size:0.88rem;
  color:#c8b6c6;
  margin-top:10px;
  margin-bottom:0;
}
.scene-space{
  position:relative;
  height:200px;
  border-radius:16px;
  overflow:hidden;
  background:
    radial-gradient(circle at 30% 20%, rgba(255,255,255,0.08), transparent 35%),
    radial-gradient(circle at 75% 40%, rgba(var(--accent),0.10), transparent 40%),
    radial-gradient(circle at 45% 70%, rgba(255,105,180,0.06), transparent 45%),
    linear-gradient(180deg, rgba(0,0,0,0.18), rgba(0,0,0,0.0));
  border:1px solid rgba(255,255,255,0.06);
}
.scene-stars{
  position:absolute; inset:0;
  background-image:
    radial-gradient(circle at 12% 30%, rgba(255,255,255,0.7) 0 1px, transparent 2px),
    radial-gradient(circle at 35% 18%, rgba(255,255,255,0.5) 0 1px, transparent 2px),
    radial-gradient(circle at 62% 32%, rgba(255,255,255,0.65) 0 1px, transparent 2px),
    radial-gradient(circle at 78% 22%, rgba(255,255,255,0.5) 0 1px, transparent 2px),
    radial-gradient(circle at 18% 72%, rgba(255,255,255,0.6) 0 1px, transparent 2px),
    radial-gradient(circle at 55% 78%, rgba(255,255,255,0.5) 0 1px, transparent 2px),
    radial-gradient(circle at 88% 74%, rgba(255,255,255,0.6) 0 1px, transparent 2px);
  opacity:0.75;
  filter:drop-shadow(0 0 8px rgba(255,255,255,0.08));
  animation:scene-twinkle 6s ease-in-out infinite alternate;
}
@keyframes scene-twinkle{0%{opacity:0.6}100%{opacity:0.9}}

.love-star-btn{
  position:absolute;
  left:18px;
  top:34px;
  width:88px;
  height:88px;
  border-radius:999px;
  border:1px solid rgba(var(--accent),0.35);
  background:
    radial-gradient(circle at 35% 30%, rgba(255,255,255,0.92), rgba(var(--accent),0.75) 32%, rgba(255,105,180,0.25) 60%, rgba(0,0,0,0) 72%),
    radial-gradient(circle at 55% 70%, rgba(var(--accent),0.25), rgba(0,0,0,0) 58%);
  box-shadow:
    0 0 25px rgba(var(--accent),0.22),
    0 0 60px rgba(255,105,180,0.10);
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  transition:transform 0.16s ease, filter 0.16s ease;
}
.love-star-btn:active{transform:scale(0.98)}
.love-star-btn .core{
  width:26px;height:26px;border-radius:999px;
  background:radial-gradient(circle at 40% 40%, #fff, rgba(var(--accent),0.9) 45%, rgba(255,105,180,0.25) 75%);
  box-shadow:0 0 18px rgba(255,255,255,0.28), 0 0 26px rgba(var(--accent),0.22);
}
.love-star-btn .heart{
  position:absolute;
  font-size:18px;
  filter:drop-shadow(0 0 10px rgba(255,105,180,0.5));
  transform:translateY(-2px);
}
.love-star-btn::after{
  content:'';
  position:absolute; inset:-30px;
  border-radius:999px;
  background:conic-gradient(from 0deg, rgba(var(--accent),0.0), rgba(var(--accent),0.18), rgba(255,105,180,0.12), rgba(var(--accent),0.0));
  opacity:0.55;
  animation:star-halo 5.5s linear infinite;
}
@keyframes star-halo{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
body.beat-hit.variation-starwars .love-star-btn{filter:brightness(1.1)}
body.beat-hit .love-star-btn{filter:brightness(1.12)}

.planet{
  position:absolute;
  right:22px;
  bottom:22px;
  width:98px;
  height:98px;
  border-radius:999px;
  background:
    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.65), rgba(var(--accent),0.35) 25%, rgba(60,80,200,0.10) 55%, rgba(0,0,0,0) 72%),
    radial-gradient(circle at 60% 65%, rgba(255,105,180,0.08), rgba(0,0,0,0) 60%),
    radial-gradient(circle at 50% 55%, rgba(0,0,0,0.22), rgba(0,0,0,0) 60%);
  box-shadow:0 0 26px rgba(var(--accent),0.14), inset 0 -16px 24px rgba(0,0,0,0.28);
  border:1px solid rgba(255,255,255,0.08);
  overflow:hidden;
}
.planet::before{
  content:'';
  position:absolute; inset:-20%;
  background:
    radial-gradient(circle at 20% 40%, rgba(255,255,255,0.10), transparent 40%),
    radial-gradient(circle at 70% 25%, rgba(255,255,255,0.08), transparent 45%),
    radial-gradient(circle at 55% 75%, rgba(0,0,0,0.20), transparent 50%);
  opacity:0.9;
  animation:planet-drift 7.5s ease-in-out infinite alternate;
}
@keyframes planet-drift{0%{transform:translate(-2%,1%) rotate(-2deg)}100%{transform:translate(2%,-1%) rotate(2deg)}}
.planet.saved{
  box-shadow:0 0 40px rgba(140,255,200,0.18), 0 0 80px rgba(var(--accent),0.18), inset 0 -14px 24px rgba(0,0,0,0.26);
}
.planet.saved::after{
  content:'';
  position:absolute; inset:-18px;
  border-radius:999px;
  border:1px solid rgba(140,255,200,0.25);
  box-shadow:0 0 24px rgba(140,255,200,0.18);
  animation:planet-saved 2.4s ease-out infinite;
}
@keyframes planet-saved{0%{transform:scale(0.85);opacity:0.0}18%{opacity:0.9}100%{transform:scale(1.15);opacity:0}}

.laser-layer{position:absolute; inset:0; pointer-events:none;}
.love-laser{
  position:absolute;
  left:56px;
  top:78px;
  width:220px;
  height:6px;
  border-radius:999px;
  background:linear-gradient(90deg, rgba(255,255,255,0.0), rgba(var(--accent),0.85), rgba(255,105,180,0.55), rgba(255,255,255,0.0));
  transform-origin:0% 50%;
  opacity:0;
  filter:drop-shadow(0 0 14px rgba(var(--accent),0.22));
  animation:laser-fire 520ms ease-out forwards;
}
@keyframes laser-fire{
  0%{opacity:0;transform:rotate(var(--ang)) scaleX(0.1)}
  18%{opacity:1;transform:rotate(var(--ang)) scaleX(1)}
  100%{opacity:0;transform:rotate(var(--ang)) scaleX(1.35)}
}
.save-badge{
  position:absolute;
  left:118px;
  top:22px;
  padding:8px 12px;
  border-radius:999px;
  background:rgba(13,2,18,0.68);
  border:1px solid rgba(255,255,255,0.10);
  color:#fff;
  font-size:0.78rem;
  letter-spacing:1px;
  opacity:0;
  transform:translateY(-6px);
  transition:opacity 0.25s ease, transform 0.25s ease;
}
.save-badge.visible{
  opacity:1;
  transform:translateY(0);
}
.save-badge .love-word{color:rgb(var(--accent))}

@media(max-width:600px){
  .scene-space{height:184px}
  .love-star-btn{width:78px;height:78px}
  .planet{width:88px;height:88px}
  .love-laser{width:190px}
}

/* â”€â”€ Rainbow overrides for LGBTQ â”€â”€ */
.rainbow-active .heart-divider{
  background:linear-gradient(90deg,#e40303,#ff8c00,#ffed00,#008026,#004dff,#750787);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
  opacity:1;
}
.rainbow-active .telegram-frame{
  border-color:rgba(255,100,0,0.25);
  animation:rainbow-frame-glow 6s linear infinite;
}
@keyframes rainbow-frame-glow{
  0%{box-shadow:0 0 20px rgba(228,3,3,0.15),inset 0 0 15px rgba(228,3,3,0.04)}
  17%{box-shadow:0 0 20px rgba(255,140,0,0.15),inset 0 0 15px rgba(255,140,0,0.04)}
  33%{box-shadow:0 0 20px rgba(255,237,0,0.15),inset 0 0 15px rgba(255,237,0,0.04)}
  50%{box-shadow:0 0 20px rgba(0,128,38,0.15),inset 0 0 15px rgba(0,128,38,0.04)}
  67%{box-shadow:0 0 20px rgba(0,77,255,0.15),inset 0 0 15px rgba(0,77,255,0.04)}
  83%{box-shadow:0 0 20px rgba(117,7,135,0.15),inset 0 0 15px rgba(117,7,135,0.04)}
  100%{box-shadow:0 0 20px rgba(228,3,3,0.15),inset 0 0 15px rgba(228,3,3,0.04)}
}
.rainbow-active .telegram-frame::before{
  background:linear-gradient(90deg,#e40303,#ff8c00,#ffed00,#008026,#004dff,#750787);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
}
.rainbow-active .love-word{
  background:linear-gradient(90deg,#e40303,#ff8c00,#ffed00,#008026,#004dff,#750787);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
  text-shadow:none;
}
.rainbow-active .love-declaration{
  background:linear-gradient(135deg,#e40303,#ff8c00,#ffed00,#008026,#004dff,#750787,#e40303);
  background-size:400% 400%;
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
  animation:rainbow-gradient 4s linear infinite;
  filter:drop-shadow(0 0 20px rgba(255,140,0,0.3));
}
@keyframes rainbow-gradient{
  0%{background-position:0% 50%}
  100%{background-position:400% 50%}
}
.rainbow-active .affirmation-card{
  border-color:rgba(255,140,0,0.2);
}
.rainbow-active .affirmation-card:hover{
  border-color:rgba(0,128,38,0.5);
  box-shadow:0 8px 24px rgba(0,77,255,0.1);
}

/* â”€â”€ Per-Variation Visual Themes â”€â”€ */
:root{
  --accent:255,105,180;
  --accent-hue:330;
}
.variation-nyc{--accent:255,180,80;--accent-hue:30}
.variation-nyc .aurora-overlay{
  background:
    radial-gradient(ellipse 80% 50% at 20% 80%, rgba(255,180,80,0.06) 0%, transparent 70%),
    radial-gradient(ellipse 60% 40% at 80% 20%, rgba(255,140,0,0.05) 0%, transparent 70%),
    radial-gradient(ellipse 70% 60% at 50% 50%, rgba(255,200,100,0.03) 0%, transparent 70%);
}
.variation-nyc h1{
  background:linear-gradient(135deg,#fff 0%,#ffe0a0 40%,#ffb347 70%,#fff 100%);
  background-size:200% 200%;
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
}
.variation-nyc .love-word{color:#ffb347;text-shadow:0 0 6px rgba(255,180,80,0.3)}
.variation-nyc .heart-divider{color:#ffb347}
.variation-nyc .telegram-frame{border-color:rgba(255,180,80,0.3)}
.variation-nyc .telegram-frame::before{color:#ffb347;text-shadow:0 0 10px rgba(255,180,80,0.5)}
.variation-nyc .love-declaration{
  background:linear-gradient(135deg,#ffb347,#ff8c00,#ffd700,#ffb347);
  background-size:300% 300%;
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
  filter:drop-shadow(0 0 20px rgba(255,180,80,0.4));
}
.variation-nyc .share-btn{background:linear-gradient(135deg,#ffb347,#ff8c00,#e67300)}
.variation-nyc .affirmation-card{border-color:rgba(255,180,80,0.15)}
.variation-nyc .affirmation-card:hover{border-color:rgba(255,180,80,0.4);box-shadow:0 8px 24px rgba(255,180,80,0.1)}

.variation-friend{--accent:140,255,200;--accent-hue:155}
.variation-friend .aurora-overlay{
  background:
    radial-gradient(ellipse 80% 50% at 20% 80%, rgba(140,255,200,0.06) 0%, transparent 70%),
    radial-gradient(ellipse 60% 40% at 80% 20%, rgba(60,180,255,0.05) 0%, transparent 70%),
    radial-gradient(ellipse 70% 60% at 50% 50%, rgba(255,255,255,0.02) 0%, transparent 70%);
}
.variation-friend h1{
  background:linear-gradient(135deg,#fff 0%,#d7fff1 40%,#8cffe6 70%,#fff 100%);
  background-size:200% 200%;
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
}
.variation-friend .love-word{color:#8cffe6;text-shadow:0 0 6px rgba(140,255,200,0.28)}
.variation-friend .heart-divider{color:#8cffe6}
.variation-friend .telegram-frame{border-color:rgba(140,255,200,0.25)}
.variation-friend .telegram-frame::before{color:#8cffe6;text-shadow:0 0 10px rgba(140,255,200,0.4)}
.variation-friend .love-declaration{
  background:linear-gradient(135deg,#8cffe6,#2aa7ff,#44d7b6,#8cffe6);
  background-size:300% 300%;
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
  filter:drop-shadow(0 0 20px rgba(140,255,200,0.25));
}
.variation-friend .share-btn{background:linear-gradient(135deg,#44d7b6,#2aa7ff,#44d7b6)}
.variation-friend .affirmation-card{border-color:rgba(140,255,200,0.14)}
.variation-friend .affirmation-card:hover{border-color:rgba(140,255,200,0.35);box-shadow:0 8px 24px rgba(140,255,200,0.08)}

.variation-usa{--accent:120,140,255;--accent-hue:230}
.variation-usa .aurora-overlay{
  background:
    radial-gradient(ellipse 80% 50% at 20% 80%, rgba(200,60,60,0.05) 0%, transparent 70%),
    radial-gradient(ellipse 60% 40% at 80% 20%, rgba(60,80,200,0.05) 0%, transparent 70%),
    radial-gradient(ellipse 70% 60% at 50% 50%, rgba(255,255,255,0.02) 0%, transparent 70%);
}
.variation-usa h1{
  background:linear-gradient(135deg,#fff 0%,#c0c0ff 40%,#8090ff 70%,#fff 100%);
  background-size:200% 200%;
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
}
.variation-usa .love-word{color:#8090ff;text-shadow:0 0 6px rgba(120,140,255,0.3)}
.variation-usa .heart-divider{color:#8090ff}
.variation-usa .telegram-frame{border-color:rgba(120,140,255,0.3)}
.variation-usa .telegram-frame::before{color:#8090ff;text-shadow:0 0 10px rgba(120,140,255,0.5)}
.variation-usa .love-declaration{
  background:linear-gradient(135deg,#ff4040,#fff,#4060ff,#ff4040);
  background-size:400% 400%;
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
  animation:usa-gradient 6s linear infinite;
  filter:drop-shadow(0 0 20px rgba(120,140,255,0.4));
}
@keyframes usa-gradient{0%{background-position:0% 50%}100%{background-position:400% 50%}}
.variation-usa .share-btn{background:linear-gradient(135deg,#4060ff,#8090ff,#4060ff)}
.variation-usa .affirmation-card{border-color:rgba(120,140,255,0.15)}
.variation-usa .affirmation-card:hover{border-color:rgba(120,140,255,0.4);box-shadow:0 8px 24px rgba(120,140,255,0.1)}

.variation-kids{--accent:255,220,140;--accent-hue:40}
.variation-kids .aurora-overlay{
  background:
    radial-gradient(ellipse 80% 50% at 20% 80%, rgba(255,220,140,0.07) 0%, transparent 70%),
    radial-gradient(ellipse 60% 40% at 80% 20%, rgba(255,105,180,0.04) 0%, transparent 70%),
    radial-gradient(ellipse 70% 60% at 50% 50%, rgba(255,255,255,0.02) 0%, transparent 70%);
}
.variation-kids h1{
  background:linear-gradient(135deg,#fff 0%,#fff1c8 40%,#ffd06a 70%,#fff 100%);
  background-size:200% 200%;
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
}
.variation-kids .love-word{color:#ffd06a;text-shadow:0 0 6px rgba(255,220,140,0.3)}
.variation-kids .heart-divider{color:#ffd06a}
.variation-kids .telegram-frame{border-color:rgba(255,220,140,0.25)}
.variation-kids .telegram-frame::before{color:#ffd06a;text-shadow:0 0 10px rgba(255,220,140,0.4)}
.variation-kids .love-declaration{
  background:linear-gradient(135deg,#ffd06a,#ffb347,#fff1c8,#ffd06a);
  background-size:300% 300%;
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
  filter:drop-shadow(0 0 20px rgba(255,220,140,0.25));
}
.variation-kids .share-btn{background:linear-gradient(135deg,#ffb347,#ffd06a,#ffb347)}
.variation-kids .affirmation-card{border-color:rgba(255,220,140,0.14)}
.variation-kids .affirmation-card:hover{border-color:rgba(255,220,140,0.35);box-shadow:0 8px 24px rgba(255,220,140,0.08)}

.variation-multilang{--accent:255,200,100;--accent-hue:40}
.variation-multilang .aurora-overlay{
  background:
    radial-gradient(ellipse 80% 50% at 20% 80%, rgba(255,200,100,0.06) 0%, transparent 70%),
    radial-gradient(ellipse 60% 40% at 80% 20%, rgba(200,160,80,0.05) 0%, transparent 70%),
    radial-gradient(ellipse 70% 60% at 50% 50%, rgba(255,220,140,0.03) 0%, transparent 70%);
}
.variation-multilang h1{
  background:linear-gradient(135deg,#fff 0%,#ffe4a0 40%,#ffc850 70%,#fff 100%);
  background-size:200% 200%;
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
}
.variation-multilang .love-word{color:#ffc850;text-shadow:0 0 6px rgba(255,200,100,0.3)}
.variation-multilang .heart-divider{color:#ffc850}
.variation-multilang .telegram-frame{border-color:rgba(255,200,100,0.3)}
.variation-multilang .telegram-frame::before{color:#ffc850;text-shadow:0 0 10px rgba(255,200,100,0.5)}
.variation-multilang .love-declaration{
  background:linear-gradient(135deg,#ffc850,#ffaa00,#ffe080,#ffc850);
  background-size:300% 300%;
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
  filter:drop-shadow(0 0 20px rgba(255,200,100,0.4));
}
.variation-multilang .share-btn{background:linear-gradient(135deg,#ffc850,#e6a800,#cc9500)}
.variation-multilang .affirmation-card{border-color:rgba(255,200,100,0.15)}
.variation-multilang .affirmation-card:hover{border-color:rgba(255,200,100,0.4);box-shadow:0 8px 24px rgba(255,200,100,0.1)}

.variation-starwars{--accent:160,210,255;--accent-hue:210;--saber-blue:#4fc3f7;--saber-red:#ff1744;--saber-green:#69f0ae;--sw-gold:#ffe81f;--sw-space:#000008}
.variation-starwars .aurora-overlay{
  background:
    radial-gradient(ellipse 80% 50% at 20% 80%, rgba(79,195,247,0.06) 0%, transparent 70%),
    radial-gradient(ellipse 60% 40% at 80% 20%, rgba(255,23,68,0.04) 0%, transparent 70%),
    radial-gradient(ellipse 70% 60% at 50% 50%, rgba(255,232,31,0.015) 0%, transparent 70%);
}
.variation-starwars h1{
  background:linear-gradient(135deg,#ffe81f 0%,#fff 40%,#ffe81f 70%,#fff 100%);
  background-size:200% 200%;
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
}
.variation-starwars .love-word{color:#ffe81f;text-shadow:0 0 8px rgba(255,232,31,0.4)}
.variation-starwars .heart-divider{color:#ffe81f;opacity:0.7}
.variation-starwars .telegram-frame{
  border-color:rgba(255,232,31,0.22);
  background:rgba(0,0,20,0.6);
  backdrop-filter:blur(16px);
}
.variation-starwars .telegram-frame::before{color:#ffe81f;text-shadow:0 0 12px rgba(255,232,31,0.45);content:'GALACTIC LOVE TRANSMISSION';font-family:'Orbitron','Inter',sans-serif;font-size:0.7rem;letter-spacing:3px}
.variation-starwars .love-declaration{
  background:linear-gradient(135deg,#ffe81f,#fff,#4fc3f7,#ffe81f);
  background-size:400% 400%;
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
  filter:drop-shadow(0 0 28px rgba(255,232,31,0.35));
}
.variation-starwars .share-btn{background:linear-gradient(135deg,#1565c0,#4fc3f7,#1565c0)}
.variation-starwars .affirmation-card{
  border-color:rgba(79,195,247,0.18);
  background:rgba(0,0,30,0.5);
}
.variation-starwars .affirmation-card:hover{border-color:rgba(255,232,31,0.4);box-shadow:0 8px 24px rgba(79,195,247,0.15)}
.variation-starwars .telegram-body{color:#c8dce8}
.variation-starwars .telegram-header{color:#5a8a9a}
.variation-starwars .telegram-header span{color:#ffe81f}
.variation-starwars .telegram-stamp{color:#5a8a9a}
.variation-starwars .quote{
  border-left-color:#4fc3f7;
  background:rgba(79,195,247,0.04);
}
.variation-starwars .quote::after{background:linear-gradient(180deg,#4fc3f7,#1565c0,#4fc3f7)}
.variation-starwars p,.variation-starwars .quote{color:#a0c0d8}
.variation-starwars em{color:#7ecbf5}
.variation-starwars strong{color:#ffe81f}
.variation-starwars h2{color:#4fc3f7;font-family:'Orbitron','Playfair Display',serif;font-style:normal;font-size:clamp(1.2rem,3vw,1.8rem);letter-spacing:1px}
.variation-starwars .video-section{
  background:rgba(79,195,247,0.06);
  border-color:rgba(79,195,247,0.2);
}
.variation-starwars .video-section::before{
  background:linear-gradient(135deg,rgba(79,195,247,0.2),transparent,rgba(255,232,31,0.15));
}
.variation-starwars .video-section h3{color:#4fc3f7}
.variation-starwars .counter-box{
  background:rgba(79,195,247,0.08);
  border-color:rgba(79,195,247,0.2);
  color:#7ecbf5;
}
.variation-starwars .counter-box .counter-num{color:#ffe81f}
.variation-starwars .counter-pulse{background:#4fc3f7}
.variation-starwars .scene-title{font-family:'Orbitron','Inter',sans-serif}
.variation-starwars .save-badge{font-family:'Orbitron','Inter',sans-serif}
.variation-starwars .from-banner{font-family:'Orbitron','Inter',sans-serif;color:#4fc3f7}
.variation-starwars .breathing-heart{filter:drop-shadow(0 0 12px rgba(79,195,247,0.5)) hue-rotate(160deg)}
.variation-starwars .share-link-btn{border-color:rgba(79,195,247,0.5);color:#7ecbf5}
.variation-starwars .share-link-btn:hover{background:rgba(79,195,247,0.15);border-color:#4fc3f7}

/* â”€â”€ SW Opening Crawl â”€â”€ */
.sw-crawl-container{
  display:none;
  position:fixed;top:0;left:0;width:100%;height:100%;
  z-index:10000;
  background:#000;
  overflow:hidden;
  cursor:pointer;
}
.sw-crawl-container.active{display:flex;flex-direction:column;align-items:center;justify-content:center}
.sw-crawl-skip{
  position:absolute;bottom:24px;right:24px;
  font-family:'Inter',sans-serif;font-size:0.8rem;
  color:rgba(255,232,31,0.5);letter-spacing:2px;
  z-index:10001;
  animation:sw-skip-pulse 2s ease-in-out infinite;
}
@keyframes sw-skip-pulse{0%,100%{opacity:0.4}50%{opacity:0.8}}
.sw-intro-text{
  color:#4fc3f7;
  font-family:'Inter',sans-serif;
  font-size:clamp(1rem,2.5vw,1.4rem);
  text-align:center;
  opacity:0;
  animation:sw-intro-fade 4s ease-in-out forwards;
}
@keyframes sw-intro-fade{0%{opacity:0}20%{opacity:1}80%{opacity:1}100%{opacity:0}}
.sw-logo{
  font-family:Georgia,'Times New Roman',serif;
  font-size:clamp(2.5rem,8vw,6rem);
  font-weight:900;
  color:#ffe81f;
  text-align:center;
  letter-spacing:0.08em;
  line-height:1;
  text-shadow:0 0 40px rgba(255,232,31,0.5),0 0 80px rgba(255,232,31,0.3);
  opacity:0;
  transform:scale(1.5);
  animation:sw-logo-zoom 6s ease-in-out forwards;
  animation-delay:4.5s;
}
@keyframes sw-logo-zoom{0%{opacity:0;transform:scale(1.5)}15%{opacity:1;transform:scale(1.2)}30%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(0)}}
.sw-crawl-perspective{
  position:absolute;bottom:0;left:50%;
  width:min(90vw,700px);
  transform:translateX(-50%);
  perspective:400px;
  overflow:hidden;
  height:100%;
  opacity:0;
  animation:sw-crawl-appear 1s ease forwards;
  animation-delay:10s;
}
@keyframes sw-crawl-appear{0%{opacity:0}100%{opacity:1}}
.sw-crawl-text{
  position:absolute;
  top:100%;
  width:100%;
  transform-origin:50% 100%;
  transform:rotateX(25deg);
  animation:sw-crawl-scroll 55s linear forwards;
  animation-delay:10s;
}
@keyframes sw-crawl-scroll{
  0%{top:100%}
  100%{top:-300%}
}
.sw-crawl-text h2{
  font-family:Georgia,'Times New Roman',serif;
  font-size:clamp(1.6rem,4vw,2.4rem);
  color:#ffe81f;
  text-align:center;
  margin-bottom:24px;
  font-weight:700;
}
.sw-crawl-text p{
  font-family:Georgia,'Times New Roman',serif;
  font-size:clamp(1rem,2.5vw,1.35rem);
  color:#ffe81f;
  text-align:justify;
  line-height:1.8;
  margin-bottom:20px;
  opacity:0.95;
}
.sw-stars-bg{
  position:absolute;inset:0;
  background:
    radial-gradient(1px 1px at 10% 15%, rgba(255,255,255,0.8), transparent),
    radial-gradient(1px 1px at 25% 35%, rgba(255,255,255,0.6), transparent),
    radial-gradient(1px 1px at 40% 20%, rgba(255,255,255,0.7), transparent),
    radial-gradient(1px 1px at 55% 45%, rgba(255,255,255,0.5), transparent),
    radial-gradient(1px 1px at 70% 10%, rgba(255,255,255,0.8), transparent),
    radial-gradient(1px 1px at 85% 60%, rgba(255,255,255,0.6), transparent),
    radial-gradient(1px 1px at 15% 75%, rgba(255,255,255,0.7), transparent),
    radial-gradient(1px 1px at 45% 85%, rgba(255,255,255,0.5), transparent),
    radial-gradient(1px 1px at 65% 70%, rgba(255,255,255,0.6), transparent),
    radial-gradient(1px 1px at 90% 30%, rgba(255,255,255,0.8), transparent),
    radial-gradient(1.5px 1.5px at 20% 50%, rgba(79,195,247,0.6), transparent),
    radial-gradient(1.5px 1.5px at 80% 80%, rgba(255,232,31,0.4), transparent);
}

/* â”€â”€ SW Hyperspace Effect â”€â”€ */
.sw-hyperspace{
  display:none;
  position:fixed;top:0;left:0;width:100%;height:100%;
  z-index:9999;pointer-events:none;
  background:radial-gradient(ellipse at center,rgba(79,195,247,0.3),transparent 60%);
}
.sw-hyperspace.active{display:block;animation:sw-hyperspace-flash 1.5s ease-out forwards}
@keyframes sw-hyperspace-flash{
  0%{opacity:0;background:radial-gradient(ellipse at center,rgba(255,255,255,0.0),transparent 40%)}
  15%{opacity:1;background:radial-gradient(ellipse at center,rgba(255,255,255,1),rgba(79,195,247,0.8) 30%,transparent 70%)}
  40%{opacity:0.8;background:radial-gradient(ellipse at center,rgba(79,195,247,0.6),transparent 50%)}
  100%{opacity:0;background:radial-gradient(ellipse at center,rgba(0,0,30,0.0),transparent)}
}
.sw-hyperspace-lines{
  position:absolute;inset:0;
  overflow:hidden;
}
.sw-hyper-line{
  position:absolute;
  left:50%;top:50%;
  width:3px;height:0;
  background:linear-gradient(to bottom,transparent,#fff,#4fc3f7,transparent);
  transform-origin:center top;
  animation:sw-hyper-streak 0.8s ease-out forwards;
}
@keyframes sw-hyper-streak{
  0%{height:0;opacity:1}
  100%{height:100vh;opacity:0}
}

/* â”€â”€ SW Falling Stars â”€â”€ */
.sw-falling-star{
  position:fixed;
  width:3px;height:3px;
  border-radius:50%;
  background:#fff;
  z-index:3;pointer-events:none;
  box-shadow:0 0 6px #fff,0 0 12px rgba(79,195,247,0.5);
  animation:sw-fall-streak var(--fall-dur,2s) linear forwards;
}
.sw-falling-star::after{
  content:'';
  position:absolute;
  top:0;left:50%;
  transform:translateX(-50%);
  width:1px;height:60px;
  background:linear-gradient(to top,transparent,rgba(255,255,255,0.8),transparent);
}
@keyframes sw-fall-streak{
  0%{transform:translate(0,0) scale(1);opacity:1}
  70%{opacity:0.8}
  100%{transform:translate(var(--fall-dx,-100px),var(--fall-dy,100vh)) scale(0.3);opacity:0}
}

/* â”€â”€ SW Lightsaber Glow Dividers â”€â”€ */
.variation-starwars .heart-divider{
  position:relative;
  letter-spacing:0;
  font-size:0;
  height:4px;
  margin:48px auto;
  width:80%;max-width:500px;
  background:linear-gradient(90deg,transparent,#4fc3f7 20%,#fff 50%,#4fc3f7 80%,transparent);
  border-radius:4px;
  box-shadow:0 0 12px rgba(79,195,247,0.6),0 0 30px rgba(79,195,247,0.3);
  animation:sw-saber-divider-pulse 3s ease-in-out infinite;
  opacity:1;
  overflow:visible;
}
.variation-starwars .heart-divider::before,.variation-starwars .heart-divider::after{
  content:'';
  position:absolute;top:50%;
  width:12px;height:12px;border-radius:50%;
  background:#fff;
  box-shadow:0 0 8px #4fc3f7,0 0 20px rgba(79,195,247,0.6);
  transform:translateY(-50%);
}
.variation-starwars .heart-divider::before{left:-6px}
.variation-starwars .heart-divider::after{right:-6px}
@keyframes sw-saber-divider-pulse{
  0%,100%{box-shadow:0 0 12px rgba(79,195,247,0.6),0 0 30px rgba(79,195,247,0.3);opacity:0.7}
  50%{box-shadow:0 0 20px rgba(79,195,247,0.9),0 0 50px rgba(79,195,247,0.5);opacity:1}
}

/* â”€â”€ SW Laser Blasters (page-wide) â”€â”€ */
.sw-laser{
  position:fixed;
  z-index:4;pointer-events:none;
  height:2px;
  border-radius:2px;
  animation:sw-laser-shoot var(--laser-dur,0.6s) linear forwards;
  opacity:0;
}
.sw-laser.blue{
  background:linear-gradient(90deg,transparent,#4fc3f7,#fff,#4fc3f7,transparent);
  box-shadow:0 0 6px #4fc3f7,0 0 15px rgba(79,195,247,0.5);
}
.sw-laser.red{
  background:linear-gradient(90deg,transparent,#ff1744,#ff8a80,#ff1744,transparent);
  box-shadow:0 0 6px #ff1744,0 0 15px rgba(255,23,68,0.5);
}
.sw-laser.green{
  background:linear-gradient(90deg,transparent,#69f0ae,#b9f6ca,#69f0ae,transparent);
  box-shadow:0 0 6px #69f0ae,0 0 15px rgba(105,240,174,0.5);
}
@keyframes sw-laser-shoot{
  0%{opacity:0;transform:scaleX(0) translateX(0)}
  10%{opacity:1}
  60%{opacity:1;transform:scaleX(1) translateX(var(--laser-tx,50vw))}
  100%{opacity:0;transform:scaleX(1.2) translateX(var(--laser-tx,50vw))}
}

/* â”€â”€ SW Character Cards â”€â”€ */
.sw-characters-grid{
  display:none;
  grid-template-columns:repeat(auto-fill,minmax(140px,1fr));
  gap:14px;
  max-width:620px;
  margin:28px auto;
}
.variation-starwars .sw-characters-grid{display:grid}
.sw-char-card{
  background:rgba(0,0,30,0.7);
  border:1px solid rgba(79,195,247,0.2);
  border-radius:14px;
  padding:16px 10px;
  text-align:center;
  transition:all 0.35s ease;
  position:relative;
  overflow:hidden;
  cursor:default;
}
.sw-char-card::before{
  content:'';position:absolute;inset:-50%;
  background:radial-gradient(circle,rgba(79,195,247,0.05),transparent 60%);
  opacity:0;transition:opacity 0.4s ease;
}
.sw-char-card:hover::before{opacity:1}
.sw-char-card:hover{
  border-color:rgba(255,232,31,0.4);
  transform:translateY(-3px);
  box-shadow:0 6px 20px rgba(79,195,247,0.12);
}
.sw-char-icon{font-size:2.2rem;margin-bottom:6px;display:block}
.sw-char-name{
  font-family:Georgia,'Times New Roman',serif;
  font-size:0.85rem;
  color:#ffe81f;
  font-weight:700;
  letter-spacing:0.5px;
}
.sw-char-title{
  font-size:0.72rem;
  color:#5a8a9a;
  margin-top:3px;
  font-style:italic;
}
.sw-char-quote{
  font-size:0.7rem;
  color:#7ecbf5;
  margin-top:6px;
  font-style:italic;
  line-height:1.4;
  opacity:0;
  max-height:0;
  overflow:hidden;
  transition:all 0.4s ease;
}
.sw-char-card:hover .sw-char-quote{opacity:1;max-height:80px;margin-top:8px}
@media(max-width:600px){
  .sw-characters-grid{grid-template-columns:repeat(2,1fr);gap:10px}
  .sw-char-icon{font-size:1.8rem}
}

/* â”€â”€ SW Yoda Wisdom Section â”€â”€ */
.sw-yoda-section{
  display:none;
  text-align:center;
  margin:40px auto;
  max-width:560px;
}
.variation-starwars .sw-yoda-section{display:block}
.sw-yoda-icon{font-size:3.5rem;margin-bottom:16px;display:block;filter:drop-shadow(0 0 20px rgba(105,240,174,0.4))}
.sw-yoda-quote{
  font-family:Georgia,'Times New Roman',serif;
  font-size:clamp(1.1rem,3vw,1.5rem);
  color:#69f0ae;
  font-style:italic;
  line-height:1.7;
  text-shadow:0 0 15px rgba(105,240,174,0.2);
  position:relative;
  padding:20px 28px;
  border:1px solid rgba(105,240,174,0.15);
  border-radius:16px;
  background:rgba(105,240,174,0.03);
}
.sw-yoda-quote::before{content:'"';position:absolute;top:8px;left:12px;font-size:2.5rem;color:rgba(105,240,174,0.3)}
.sw-yoda-quote::after{content:'"';position:absolute;bottom:-8px;right:12px;font-size:2.5rem;color:rgba(105,240,174,0.3)}
.sw-yoda-attr{
  font-size:0.8rem;
  color:#5a8a7a;
  margin-top:12px;
  letter-spacing:2px;
  font-family:'Special Elite',cursive;
}

/* â”€â”€ SW Scene Canvas (TIE Fighters, X-Wings, Death Star) â”€â”€ */
#sw-scene-canvas{
  display:none;
  position:fixed;top:0;left:0;width:100%;height:100%;
  z-index:1;pointer-events:none;
}
.variation-starwars #sw-scene-canvas{display:block}

/* â”€â”€ SW Force Particles â”€â”€ */
.sw-force-particle{
  position:fixed;
  width:2px;height:2px;
  border-radius:50%;
  pointer-events:none;
  z-index:3;
  animation:sw-force-float var(--fp-dur,4s) ease-in-out forwards;
}
@keyframes sw-force-float{
  0%{opacity:0;transform:translate(0,0) scale(0.5)}
  20%{opacity:1}
  80%{opacity:0.8}
  100%{opacity:0;transform:translate(var(--fp-dx,20px),var(--fp-dy,-80px)) scale(0)}
}

/* â”€â”€ SW Hologram effect on telegram â”€â”€ */
.variation-starwars .telegram-frame{
  animation:sw-hologram-flicker 8s ease-in-out infinite;
}
@keyframes sw-hologram-flicker{
  0%,100%{box-shadow:0 0 15px rgba(79,195,247,0.08),inset 0 0 15px rgba(79,195,247,0.03)}
  20%{box-shadow:0 0 20px rgba(79,195,247,0.12),inset 0 0 20px rgba(79,195,247,0.05)}
  21%{box-shadow:0 0 5px rgba(79,195,247,0.02),inset 0 0 5px rgba(79,195,247,0.01)}
  23%{box-shadow:0 0 25px rgba(79,195,247,0.15),inset 0 0 25px rgba(79,195,247,0.06)}
  50%{box-shadow:0 0 30px rgba(79,195,247,0.18),inset 0 0 30px rgba(79,195,247,0.08)}
  70%{box-shadow:0 0 20px rgba(79,195,247,0.10),inset 0 0 20px rgba(79,195,247,0.04)}
  71%{box-shadow:0 0 3px rgba(79,195,247,0.01),inset 0 0 3px rgba(79,195,247,0.01)}
  73%{box-shadow:0 0 22px rgba(79,195,247,0.13),inset 0 0 22px rgba(79,195,247,0.05)}
}

/* â”€â”€ SW scanline overlay on telegram â”€â”€ */
.variation-starwars .telegram-frame::after{
  content:'';
  position:absolute;inset:0;
  background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(79,195,247,0.02) 2px,rgba(79,195,247,0.02) 4px);
  pointer-events:none;
  border-radius:18px;
  animation:sw-scanlines 0.1s steps(2) infinite;
}
@keyframes sw-scanlines{0%{transform:translateY(0)}100%{transform:translateY(4px)}}

/* â”€â”€ SW Episode Badges â”€â”€ */
.sw-episode-badges{
  display:none;
  gap:10px;
  justify-content:center;
  flex-wrap:wrap;
  margin:24px auto;
  max-width:560px;
}
.variation-starwars .sw-episode-badges{display:flex}
.sw-episode-badge{
  padding:8px 16px;
  border:1px solid rgba(255,232,31,0.25);
  border-radius:20px;
  font-family:Georgia,'Times New Roman',serif;
  font-size:0.75rem;
  color:#ffe81f;
  letter-spacing:1px;
  background:rgba(255,232,31,0.04);
  transition:all 0.3s ease;
}
.sw-episode-badge:hover{
  background:rgba(255,232,31,0.1);
  border-color:rgba(255,232,31,0.5);
  box-shadow:0 0 15px rgba(255,232,31,0.1);
}

/* â”€â”€ Accessibility: Reduced Motion â”€â”€ */
@media(prefers-reduced-motion:reduce){
  *,*::before,*::after{
    animation-duration:0.01ms !important;
    animation-iteration-count:1 !important;
    transition-duration:0.01ms !important;
  }
  .sparkle,.magic-orb,.detonate-flash{display:none !important}
  .section{opacity:1 !important;transform:none !important}
  .affirmation-card{opacity:1 !important;transform:none !important}
}

/* â”€â”€ Personalization banner â”€â”€ */
.from-banner{
  font-family:'Special Elite',cursive;
  font-size:0.9rem;
  color:#ffb6c1;
  letter-spacing:2px;
  margin-bottom:8px;
  opacity:0.8;
}

/* â”€â”€ Detonation Flash â”€â”€ */
.detonate-flash{
  position:fixed;top:0;left:0;width:100%;height:100%;
  z-index:9999;pointer-events:none;
  background:radial-gradient(circle at center,rgba(255,20,147,0.35) 0%,rgba(255,105,180,0.15) 40%,transparent 70%);
  animation:detonate-fade 1.8s ease-out forwards;
}
@keyframes detonate-fade{
  0%{opacity:1;transform:scale(0.8)}
  20%{opacity:1;transform:scale(1.2)}
  100%{opacity:0;transform:scale(2)}
}

/* â”€â”€ Song info below video â”€â”€ */
.song-info{
  font-family:'Special Elite',cursive;
  font-size:0.95rem;
  color:#ff69b4;
  letter-spacing:1px;
  margin-top:12px;
  text-shadow:0 0 8px rgba(255,105,180,0.3);
  opacity:0;
  transition:opacity 1.5s ease 0.5s;
}
.song-info.visible{
  opacity:1;
}

/* â”€â”€ Breathing Heart â€” emotional pacing between sections â”€â”€ */
.breathing-heart{
  display:inline-block;
  font-size:2.4rem;
  animation:heart-breathe 1.8s ease-in-out infinite;
  filter:drop-shadow(0 0 12px rgba(255,105,180,0.5));
  margin:16px 0;
}
@keyframes heart-breathe{
  0%{transform:scale(1);opacity:0.7}
  12%{transform:scale(1.15);opacity:1}
  24%{transform:scale(1);opacity:0.8}
  36%{transform:scale(1.08);opacity:0.95}
  48%{transform:scale(1);opacity:0.7}
  100%{transform:scale(1);opacity:0.7}
}

/* â”€â”€ Love Ripple Effect â”€â”€ */
.love-ripple-container{
  position:relative;
  display:flex;
  align-items:center;
  justify-content:center;
  height:120px;
  margin:24px auto;
}
.love-ripple{
  position:absolute;
  border-radius:50%;
  border:1px solid rgba(255,105,180,0.3);
  animation:ripple-expand 3s ease-out infinite;
}
.love-ripple:nth-child(2){animation-delay:1s}
.love-ripple:nth-child(3){animation-delay:2s}
@keyframes ripple-expand{
  0%{width:20px;height:20px;opacity:0.8}
  100%{width:200px;height:200px;opacity:0}
}
.love-ripple-heart{
  position:relative;z-index:1;
  font-size:2rem;
  animation:heart-breathe 1.8s ease-in-out infinite;
}

/* â”€â”€ Timestamp glow â”€â”€ */
.love-timestamp{
  font-family:'Special Elite',cursive;
  font-size:0.8rem;
  color:#a07888;
  letter-spacing:2px;
  margin-top:12px;
  opacity:0.7;
}

/* â”€â”€ Haptic pulse indicator â”€â”€ */
.haptic-pulse{
  position:fixed;bottom:20px;left:20px;
  width:12px;height:12px;border-radius:50%;
  background:rgb(var(--accent));
  z-index:50;pointer-events:none;
  opacity:0;
  transition:opacity 0.3s;
}
.haptic-pulse.active{
  opacity:1;
  animation:haptic-beat 0.15s ease-out;
}
@keyframes haptic-beat{
  0%{transform:scale(1);box-shadow:0 0 0 0 rgba(var(--accent),0.6)}
  100%{transform:scale(2);box-shadow:0 0 0 12px rgba(var(--accent),0)}
}

/* â”€â”€ Beat-synced UI pulse (subtle, non-strobing) â”€â”€ */
#hook-title,
.telegram-frame,
.video-section,
.love-declaration,
.share-btn,
.share-link-btn,
.heart-divider,
.breathing-heart,
.love-ripple-heart{
  will-change:transform,filter;
  transition:transform 140ms ease,filter 180ms ease;
}
body.beat-hit #hook-title{
  filter:drop-shadow(0 0 16px rgba(var(--accent),0.18));
}
body.beat-hit .telegram-frame,
body.beat-hit .video-section{
  transform:translateZ(0) scale(1.004);
  filter:drop-shadow(0 0 18px rgba(var(--accent),0.14));
}
body.beat-hit .love-declaration{
  transform:translateZ(0) scale(1.006);
  filter:drop-shadow(0 0 26px rgba(var(--accent),0.22));
}
body.beat-hit .share-btn{
  transform:translateZ(0) scale(1.02);
}
body.beat-hit .share-link-btn{
  transform:translateZ(0) scale(1.01);
}
body.beat-hit .heart-divider{
  transform:translateZ(0) scale(1.01);
}
body.beat-hit .breathing-heart,
body.beat-hit .love-ripple-heart{
  transform:translateZ(0) scale(1.04);
}

/* Extra mode = intentionally overwhelming */
body.extra-mode.beat-hit .telegram-frame,
body.extra-mode.beat-hit .video-section{
  transform:translateZ(0) scale(1.012);
  filter:drop-shadow(0 0 26px rgba(var(--accent),0.22));
}
body.extra-mode.beat-hit .love-declaration{
  transform:translateZ(0) scale(1.02);
  filter:drop-shadow(0 0 44px rgba(var(--accent),0.32));
}
body.extra-mode.beat-hit .share-btn{transform:translateZ(0) scale(1.05)}
body.extra-mode .haptic-pulse{width:14px;height:14px}

@media(prefers-reduced-motion:reduce){
  body.beat-hit #hook-title,
  body.beat-hit .telegram-frame,
  body.beat-hit .video-section,
  body.beat-hit .love-declaration,
  body.beat-hit .share-btn,
  body.beat-hit .share-link-btn,
  body.beat-hit .heart-divider,
  body.beat-hit .breathing-heart,
  body.beat-hit .love-ripple-heart{
    transform:none !important;
    filter:none !important;
  }
}
</style>
</head>
<body>

<!-- SW Opening Crawl (shown only for starwars variation) -->
<div class="sw-crawl-container" id="sw-crawl-container" aria-hidden="true">
  <div class="sw-stars-bg" aria-hidden="true"></div>
  <div class="sw-intro-text" id="sw-intro-text">A long time ago in a galaxy far, far away....</div>
  <div class="sw-logo" id="sw-logo">LOVE<br>WARS</div>
  <div class="sw-crawl-perspective" id="sw-crawl-perspective">
    <div class="sw-crawl-text" id="sw-crawl-text">
      <h2>Episode IV<br>A NEW LOVE</h2>
      <p>It is a period of quiet hearts. Across the galaxy, people have forgotten to tell each other the most important truth: you are loved.</p>
      <p>But a rebel alliance of love bombers has emerged, armed with nothing but kindness, courage, and an unstoppable belief that love is the most powerful force in the universe.</p>
      <p>One brave soul has intercepted this transmission and sent it directly to you â€” a love bomb of galactic proportions, carrying a message that even the Empire cannot silence:</p>
      <p>You are loved. You have always been loved. And the Force of love surrounds you, penetrates you, and binds the galaxy together....</p>
    </div>
  </div>
  <div class="sw-crawl-skip" id="sw-crawl-skip">TAP TO SKIP</div>
</div>

<!-- SW Hyperspace Transition -->
<div class="sw-hyperspace" id="sw-hyperspace" aria-hidden="true">
  <div class="sw-hyperspace-lines" id="sw-hyperspace-lines"></div>
</div>

<!-- SW Scene Canvas (TIE fighters, X-Wings, Death Star) -->
<canvas id="sw-scene-canvas"></canvas>

<canvas id="star-canvas"></canvas>
<div class="aurora-overlay"></div>
<canvas id="heart-canvas"></canvas>
<div class="haptic-pulse" id="haptic-pulse"></div>

<div class="content">

  <!-- â•â•â• VARIATION PICKER â•â•â• -->
  <div class="section" id="variation-picker" style="margin-bottom:24px">
    <p style="font-size:0.85rem;color:#a07888;margin-bottom:12px">Choose your love bomb:</p>
    <div class="top-controls">
      <button class="mode-toggle" id="extra-toggle" type="button" aria-pressed="false">Extra mode: OFF</button>
    </div>
    <div class="variation-btns" id="variation-btns"></div>
  </div>

  <!-- â•â•â• HOOK â•â•â• (deeply personal love) -->
  <div class="section" id="s1">
    <div class="from-banner" id="from-banner" style="display:none"></div>
    <h1 id="hook-title">Someone just sent you<br>a love bomb.</h1>
    <p>Not the scary kind. The kind that wraps around you like a warm blanket on a cold night and whispers: <em>you matter.</em></p>
    <p>Someone thought of <strong>you</strong>. Out of everyone in their world, they chose you. Right now, in this moment, <span class="love-word">you are the reason this page exists.</span></p>
    <p>This was made for you. Every word. Every heart. Every glow. <strong>Scroll down and feel it.</strong></p>
    <p id="variation-hook-sub" style="font-size:0.95rem;color:#c090a8;margin-top:16px"></p>

    <!-- Star Wars-ish Love Scene (hidden unless starwars variation) -->
    <div class="starwars-scene" id="starwars-scene" aria-hidden="true">
      <div class="scene-title">LOVE STAR PROTOCOL</div>
      <div class="scene-space" role="group" aria-label="Love Star saving a planet with love">
        <div class="scene-stars" aria-hidden="true"></div>
        <div class="laser-layer" id="laser-layer" aria-hidden="true"></div>
        <button class="love-star-btn" id="love-star-btn" type="button" aria-label="Fire love lasers and save the planet">
          <span class="heart" aria-hidden="true">ðŸ’—</span>
          <span class="core" aria-hidden="true"></span>
        </button>
        <div class="save-badge" id="save-badge" aria-live="polite"></div>
        <div class="planet" id="love-planet" aria-hidden="true"></div>
      </div>
      <p class="scene-sub">Tap the Love Star. Send <span class="love-word">love lasers</span>. Save a planet with love.</p>
    </div>

    <!-- SW Episode Badges (Original Trilogy) -->
    <div class="sw-episode-badges" aria-label="The Original Trilogy">
      <span class="sw-episode-badge">EP IV Â· A New Hope</span>
      <span class="sw-episode-badge">EP V Â· The Empire Strikes Back</span>
      <span class="sw-episode-badge">EP VI Â· Return of the Jedi</span>
    </div>

    <!-- SW Yoda Wisdom (rotates quotes) -->
    <div class="sw-yoda-section" id="sw-yoda-section">
      <span class="sw-yoda-icon">ðŸ§™â€â™‚ï¸</span>
      <div class="sw-yoda-quote" id="sw-yoda-quote">Do or do not. There is no try. But love â€” love you must always try.</div>
      <div class="sw-yoda-attr">â€” MASTER YODA</div>
    </div>

    <!-- Philly LOVE Sculpture (hidden unless philly variation) -->
    <div class="love-sculpture-wrap" id="love-sculpture">
      <div class="love-sculpture">
        <span>L</span><span class="sculpture-o">O</span>
        <span>V</span><span>E</span>
      </div>
    </div>

    <p id="scroll-hint" style="font-size:0.9rem;color:#a07888;margin-top:40px">scroll down</p>
    <p id="scroll-arrow" style="font-size:1.4rem;color:#ff69b4;animation:bounce 2s infinite">&#8595;</p>
  </div>

  <!-- â•â•â• THE TELEGRAM â•â•â• (the heart of the love bomb) -->
  <div class="section" id="s2">
    <div class="telegram-frame">
      <div class="telegram-header">
        FROM: <span id="var-from">Someone who loves you</span><br>
        TO: <span id="var-to">You, right now, reading this</span><br>
        RE: <span id="var-re">Things you need to hear</span>
      </div>
      <div class="telegram-body">
        You are <span class="love-word">loved</span>. Not in some vague, distant, "everyone is loved" way â€” right here, right now, by the specific person who sent you this. They thought of <strong>you</strong>. They chose <strong>you</strong>. They wanted <strong>you</strong> to feel something real today.
        <br><br>
        You matter more than you let yourself believe. Your laugh makes rooms lighter. Your kindness leaves marks on people you'll never know about. The way you care, the way you try, even the way you doubt yourself â€” it all means you have a heart that <span class="love-word">feels deeply</span>. That's not weakness. That's your superpower.
        <br><br>
        If no one's told you lately: <span class="love-word">you are enough</span>. Exactly as you are. Not when you fix that thing. Not when you achieve that goal. Not someday. <em>Right now.</em> You â€” imperfect, beautiful, trying-your-best you â€” are enough.
        <br><br>
        The person who sent this didn't do it by accident. They did it because you crossed their mind and their heart said: <em>"They need to know."</em> So here it is. You're seen. You're valued. You're cherished. <span class="love-word">You are loved.</span>
        <br><br>
        Hold onto this feeling. It's real. And when you're ready â€” pass it on to someone who needs to hear it too.
      </div>
      <div class="telegram-stamp">SENT WITH ALL MY LOVE &#10084;</div>
    </div>
  </div>

  <div class="heart-divider">&#10084; &#10084; &#10084; &#10084; &#10084;</div>

  <!-- â•â•â• LOVE AFFIRMATIONS â•â•â• (making them feel truly loved) -->
  <div class="section" id="s-affirmations">
    <h2>In case you needed reminders</h2>
    <p>The person who sent this wants you to carry these with you today:</p>
    <div class="affirmation-grid">
      <div class="affirmation-card">
        <span class="affirmation-emoji">ðŸ’—</span>
        <span class="affirmation-text">You make the world gentler just by being in it.</span>
      </div>
      <div class="affirmation-card">
        <span class="affirmation-emoji">âœ¨</span>
        <span class="affirmation-text">Someone's favorite memory has you in it.</span>
      </div>
      <div class="affirmation-card">
        <span class="affirmation-emoji">ðŸŒ™</span>
        <span class="affirmation-text">You've gotten through every hard day so far. That's a perfect record.</span>
      </div>
      <div class="affirmation-card">
        <span class="affirmation-emoji">ðŸ’Œ</span>
        <span class="affirmation-text">Someone out there is grateful you exist. That someone sent you this.</span>
      </div>
      <div class="affirmation-card">
        <span class="affirmation-emoji">ðŸ¦‹</span>
        <span class="affirmation-text">You don't have to earn love. It's already yours.</span>
      </div>
      <div class="affirmation-card">
        <span class="affirmation-emoji">ðŸ”¥</span>
        <span class="affirmation-text">Your heart is brave. Even when it doesn't feel that way.</span>
      </div>
      <div class="affirmation-card">
        <span class="affirmation-emoji">ðŸŒŠ</span>
        <span class="affirmation-text">You've made someone smile today without even knowing it.</span>
      </div>
      <div class="affirmation-card">
        <span class="affirmation-emoji">ðŸ•Šï¸</span>
        <span class="affirmation-text">The people who truly know you are the luckiest people alive.</span>
      </div>
    </div>
    <div class="breathing-heart">&#10084;&#65039;</div>
  </div>

  <div class="heart-divider">&#10084; &#10084; &#10084; &#10084; &#10084;</div>

  <!-- â•â•â• SW HEROES OF THE ORIGINAL TRILOGY â•â•â• -->
  <div class="section" id="s-sw-characters">
    <h2 class="sw-yoda-section" style="display:none;color:#ffe81f;font-style:normal;font-family:Georgia,'Times New Roman',serif">Heroes of the Original Trilogy</h2>
    <p class="sw-yoda-section" style="display:none">Every character in this saga taught us something about love, loyalty, and the light inside all of us.</p>
    <div class="sw-characters-grid" id="sw-characters-grid">
      <div class="sw-char-card">
        <span class="sw-char-icon">âš”ï¸</span>
        <span class="sw-char-name">Luke Skywalker</span>
        <span class="sw-char-title">The Last Hope</span>
        <span class="sw-char-quote">"I am a Jedi, like my father before me."</span>
      </div>
      <div class="sw-char-card">
        <span class="sw-char-icon">ðŸ‘‘</span>
        <span class="sw-char-name">Princess Leia</span>
        <span class="sw-char-title">Leader of the Rebellion</span>
        <span class="sw-char-quote">"Help me, Obi-Wan Kenobi. You're my only hope."</span>
      </div>
      <div class="sw-char-card">
        <span class="sw-char-icon">ðŸš€</span>
        <span class="sw-char-name">Han Solo</span>
        <span class="sw-char-title">Scoundrel with a Heart</span>
        <span class="sw-char-quote">"I know." â€” the most romantic line ever spoken.</span>
      </div>
      <div class="sw-char-card">
        <span class="sw-char-icon">ðŸ§™â€â™‚ï¸</span>
        <span class="sw-char-name">Yoda</span>
        <span class="sw-char-title">Jedi Grand Master</span>
        <span class="sw-char-quote">"Luminous beings are we, not this crude matter."</span>
      </div>
      <div class="sw-char-card">
        <span class="sw-char-icon">ðŸŒŸ</span>
        <span class="sw-char-name">Obi-Wan Kenobi</span>
        <span class="sw-char-title">The Wise Guardian</span>
        <span class="sw-char-quote">"The Force will be with you. Always."</span>
      </div>
      <div class="sw-char-card">
        <span class="sw-char-icon">ðŸ˜ˆ</span>
        <span class="sw-char-name">Darth Vader</span>
        <span class="sw-char-title">Redeemed by Love</span>
        <span class="sw-char-quote">"You were right about me. Tell your sister... you were right."</span>
      </div>
      <div class="sw-char-card">
        <span class="sw-char-icon">ðŸ»</span>
        <span class="sw-char-name">Chewbacca</span>
        <span class="sw-char-title">Loyal Co-Pilot</span>
        <span class="sw-char-quote">RRRAARRWHHGWWR! (Translation: I love you, pal.)</span>
      </div>
      <div class="sw-char-card">
        <span class="sw-char-icon">ðŸ¤–</span>
        <span class="sw-char-name">R2-D2 & C-3PO</span>
        <span class="sw-char-title">The Best Duo in the Galaxy</span>
        <span class="sw-char-quote">"We're doomed!" â€” but love always saves the day.</span>
      </div>
      <div class="sw-char-card">
        <span class="sw-char-icon">ðŸŽ­</span>
        <span class="sw-char-name">Lando Calrissian</span>
        <span class="sw-char-title">Galactic Smooth Operator</span>
        <span class="sw-char-quote">"This deal is getting better all the time."</span>
      </div>
    </div>

    <!-- Second Yoda Wisdom Block -->
    <div class="sw-yoda-section" id="sw-yoda-section-2" style="margin-top:32px">
      <span class="sw-yoda-icon">âœ¨</span>
      <div class="sw-yoda-quote" id="sw-yoda-quote-2">Fear is the path to the dark side. But love â€” love is the path to everything luminous.</div>
      <div class="sw-yoda-attr">â€” MASTER YODA</div>
    </div>
  </div>

  <div class="heart-divider">&#10084; &#10084; &#10084; &#10084; &#10084;</div>

  <!-- â•â•â• A LOVE LETTER â•â•â• (deepening the emotional connection) -->
  <div class="section" id="s-letter">
    <h2>A quiet truth from whoever sent this</h2>
    <div class="love-ripple-container">
      <div class="love-ripple"></div>
      <div class="love-ripple"></div>
      <div class="love-ripple"></div>
      <span class="love-ripple-heart">&#10084;&#65039;</span>
    </div>
    <div class="quote">
      I don't say it enough. Nobody does. But you've changed my life in ways I don't even know how to articulate. The way you show up for people. The way you carry so much and still find a way to be kind. The way you light up when you talk about things you love. I notice. I've always noticed.
      <br><br>
      So instead of waiting for the perfect moment, I'm sending you this. Because you deserve to know â€” today, not someday â€” that <strong>you are deeply, truly, unmistakably loved.</strong> Not for what you do. For who you are.
    </div>
    <p>They meant every word of that. Read it again if you need to. Let it sink in. <em>That person loves you.</em></p>
    <div class="love-timestamp" id="love-sent-time"></div>
  </div>

  <div class="heart-divider">&#10084; &#10084; &#10084; &#10084; &#10084;</div>

  <!-- â•â•â• THE TRUTH â€” personal love focus â•â•â• -->
  <div class="section" id="s4">
    <h2>You already know this is true</h2>
    <p>Think of someone who matters to you. A friend. A family member. The person you haven't called in too long but still think about at 2am.</p>
    <div class="quote">
      Would they feel better or worse<br>if they knew you were thinking of them right now?
    </div>
    <p>The answer has never once been <em>"worse."</em></p>
    <p>That's the whole secret of a love bomb. <span class="love-word">Love works.</span> When you send it. When you receive it. Between two people. No conditions, no fine print. It just <em>works.</em></p>
    <div class="love-declaration">You Are Loved</div>

    <!-- SW Force Wisdom after declaration -->
    <div class="sw-yoda-section" id="sw-yoda-section-3" style="margin-top:24px">
      <span class="sw-yoda-icon">ðŸ’«</span>
      <div class="sw-yoda-quote" id="sw-yoda-quote-3">Truly wonderful, the mind of a loved one is. Already inside you, this love is. Recognize it, you must.</div>
      <div class="sw-yoda-attr">â€” MASTER YODA</div>
    </div>
  </div>

  <div class="heart-divider">&#10084; &#10084; &#10084; &#10084; &#10084;</div>

  <!-- â•â•â• VIDEO â•â•â• -->
  <div class="section" id="s5">
    <div class="video-section">
      <h3>While you're here, let this play.</h3>
      <div class="subtitle">The person who sent this picked this song for you.</div>
      <div class="song-info" id="song-info"></div>
      <div class="yt-container" id="yt-container">
        <div id="yt-player"></div>
        <div class="unmute-overlay" id="unmute-overlay">
          <button class="unmute-btn" id="unmute-btn">
            <span class="unmute-icon">ðŸ”‡</span>
            <span class="unmute-label" id="unmute-label">Turn on music</span>
          </button>
        </div>
      </div>
      <div class="tap-to-hear" id="tap-to-hear" title="Tap for sound" role="button" aria-label="Enable music" tabindex="0">ðŸ”Š</div>
      <div class="haptics-status" id="haptics-status" aria-live="polite"></div>
    </div>
    <p style="margin-top:24px;font-size:0.95rem;color:#a07888">Let the music play. Watch the hearts. <span class="love-word">Feel the love.</span></p>
  </div>

  <div class="heart-divider">&#10084; &#10084; &#10084; &#10084; &#10084;</div>

  <!-- â•â•â• HOW IT SPREADS â•â•â• -->
  <div class="section" id="s6">
    <h2>How a love bomb works</h2>
    <p>Someone sent this to you because they <span class="love-word">love you</span>. They thought of you. They chose you. That's the whole trick â€” there is no trick. Just love, delivered.</p>
    <p>One person thinks of someone they love. They send this page. That person reads it, <em>feels it</em>, and sends it to someone <strong>they</strong> love. And on and on. Love gets passed forward â€” one heart at a time.</p>
    <div class="quote">
      One person sends love. Another person receives it.<br>
      Then they send it forward. That's how love grows.
    </div>
    <div class="counter-box">
      <div class="counter-pulse"></div>
      <span>love bombs sent:</span>
      <span class="counter-num" id="love-counter">â€”</span>
    </div>
    <p style="font-size:0.9rem;color:#806070;margin-top:16px" id="variation-world-note">And when enough people send love to each other â€” the whole world quietly gets a little more peaceful.</p>
    <p style="font-size:0.8rem;color:#604050;margin-top:8px;font-style:italic">more love = more world peace</p>
  </div>

  <div class="heart-divider">&#10084; &#10084; &#10084; &#10084; &#10084;</div>

  <!-- â•â•â• SEND ONE â•â•â• -->
  <div class="section" id="s7">
    <h2>Now it's your turn</h2>
    <p>You've been love bombed. You felt it. That warmth in your chest right now â€” that's real. You can't un-feel it.</p>
    <p>Close your eyes for a second. Think of <strong>one person</strong> who needs to hear that they're loved today. A friend who's been quiet lately. A parent who gave everything. A partner. A sibling. Someone you haven't reached out to in too long. <span class="love-word">That person.</span> The one who just popped into your head without you even trying.</p>
    <p>That's your heart telling you something. <em>Listen to it.</em></p>
    <p>Send them this. No explanation needed â€” the page does the talking. They'll open it, feel exactly what you just felt, and know that <strong>someone in this world loves them</strong>. And that someone is you.</p>
    <p style="margin:32px 0">
      <button class="share-btn" onclick="shareLoveBomb()" aria-label="Share this love bomb with someone you love">
        &#128140;&ensp;Send a love bomb to someone you love
      </button>
    </p>
    <p style="margin:16px 0">
      <button class="share-link-btn" onclick="copyLink()" aria-label="Copy the love bomb link to clipboard">
        &#128279;&ensp;Copy link
      </button>
    </p>
    <p style="font-size:0.9rem;color:#806070;margin-top:8px">No signup. No cost. No catch. Just love, passed forward.</p>
  </div>

  <!-- â•â•â• FINAL â•â•â• -->
  <div class="section" id="s8" style="margin-bottom:15vh">
    <div class="breathing-heart" style="font-size:3rem">&#10084;&#65039;</div>
    <p style="font-family:'Playfair Display',serif;font-size:clamp(1.2rem,3vw,1.6rem);font-style:italic;color:#ffb6c1;margin-bottom:24px">You were always loved.<br>Now someone made sure you know it.</p>
    <div class="love-declaration" style="font-size:clamp(1.6rem,4.5vw,2.8rem)">You Are Loved &#10084;</div>
    <p style="font-style:italic;color:#c090a8;margin-top:20px">Right now, someone is waiting to feel what you just felt.</p>
    <p style="font-style:italic;color:#a07888;margin-top:8px">Send it forward. Be the reason someone smiles today.</p>
    <p style="font-style:italic;color:#806070;margin-top:16px;font-size:0.9rem">And you â€” you were always, always, always loved.</p>
    <p style="font-family:'Special Elite',cursive;color:#604050;margin-top:24px;font-size:0.75rem;letter-spacing:3px">MADE WITH NOTHING BUT LOVE</p>
  </div>

</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- SCRIPTS                                     -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
/* â”€â”€ Early Variation Detection â”€â”€ */
var currentVariationId = 'default';
var currentVariationConfig = LOVE_BOMB_VARIATIONS['default'];
(function detectVariationEarly() {
  var params = new URLSearchParams(window.location.search);
  var v = params.get('v') || 'default';
  currentVariationId = LOVE_BOMB_VARIATIONS[v] ? v : 'default';
  currentVariationConfig = LOVE_BOMB_VARIATIONS[currentVariationId];
})();

/* â”€â”€ Motion/Power Preferences (mobile stability) â”€â”€ */
var reduceMotion = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
var saveData = !!(navigator.connection && navigator.connection.saveData);
var lowPowerMode = saveData;
try {
  var __rmq = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)');
  if (__rmq) {
    var __onRM = function(e) { reduceMotion = !!(e && e.matches); };
    if (__rmq.addEventListener) __rmq.addEventListener('change', __onRM);
    else if (__rmq.addListener) __rmq.addListener(__onRM);
  }
} catch (e) {}

/* â”€â”€ Extra Mode (opt-in chaos) â”€â”€ */
var extraMode = false;
(function initExtraMode() {
  var params = new URLSearchParams(window.location.search);
  var fromUrl = params.get('extra') === '1';
  var fromStore = false;
  try { fromStore = localStorage.getItem('loveBombExtra') === '1'; } catch (e) {}
  extraMode = !!(fromUrl || fromStore);
  function extraAllowedForCurrentVariation() {
    return currentVariationId !== 'kids';
  }
  function applyExtraBodyClass() {
    document.body.classList.toggle('extra-mode', !!(extraMode && extraAllowedForCurrentVariation()));
  }
  applyExtraBodyClass();

  function syncExtraUi() {
    var btn = document.getElementById('extra-toggle');
    if (!btn) return;
    var effective = !!(extraMode && extraAllowedForCurrentVariation());
    btn.classList.toggle('active', effective);
    btn.setAttribute('aria-pressed', effective ? 'true' : 'false');
    btn.textContent = effective ? 'Extra mode: ON' : 'Extra mode: OFF';
  }

  function setExtraMode(on) {
    extraMode = !!on;
    try { localStorage.setItem('loveBombExtra', extraMode ? '1' : '0'); } catch (e) {}
    applyExtraBodyClass();
    syncExtraUi();
    if (extraMode && extraAllowedForCurrentVariation()) {
      onUserInteraction();
      unlockExtraTone();
    } else {
      stopExtraTone();
    }
  }

  window.__setExtraMode = setExtraMode;
  document.addEventListener('DOMContentLoaded', syncExtraUi);

  var btn = document.getElementById('extra-toggle');
  if (btn) {
    syncExtraUi();
    btn.addEventListener('click', function(e) {
      e.preventDefault();
      setExtraMode(!extraMode);
    });
    btn.addEventListener('touchend', function(e) {
      e.preventDefault();
      setExtraMode(!extraMode);
    }, { passive: false });
  }

  /* Expose refresh hook so variation system can re-apply effective mode */
  window.__refreshExtraModeEffective = function() {
    applyExtraBodyClass();
    syncExtraUi();
    if (!(extraMode && extraAllowedForCurrentVariation())) stopExtraTone();
  };
})();

/* â”€â”€ Mobile Version Detection â”€â”€ */
(function initMobileVersion() {
  var params = new URLSearchParams(window.location.search);
  var forceMobile = params.get('mobile') === '1';
  var compactViewport = window.matchMedia('(max-width: 820px)');
  var coarsePointer = window.matchMedia('(hover: none), (pointer: coarse)');

  function setViewportHeightVar() {
    document.documentElement.style.setProperty('--app-vh', (window.innerHeight * 0.01) + 'px');
  }

  function applyMobileClass() {
    var enableMobile = forceMobile || compactViewport.matches || coarsePointer.matches;
    document.body.classList.toggle('mobile-version', enableMobile);
  }

  setViewportHeightVar();
  applyMobileClass();
  window.addEventListener('resize', function() {
    setViewportHeightVar();
    applyMobileClass();
  });
})();

/* â”€â”€ Starfield â€” twinkling stars background (magical layer) â”€â”€ */
(function initStarfield() {
  var starCanvas = document.getElementById('star-canvas');
  var sctx = starCanvas.getContext('2d');
  var stars = [];
  var isMobile = window.innerWidth <= 600;
  var STAR_COUNT = lowPowerMode ? (isMobile ? 24 : 70) : (isMobile ? 50 : 120);

  function resizeStars() {
    starCanvas.width = window.innerWidth;
    starCanvas.height = window.innerHeight;
  }
  window.addEventListener('resize', resizeStars);
  resizeStars();

  for (var i = 0; i < STAR_COUNT; i++) {
    stars.push({
      x: Math.random() * starCanvas.width,
      y: Math.random() * starCanvas.height,
      r: 0.5 + Math.random() * 1.5,
      phase: Math.random() * Math.PI * 2,
      speed: 0.005 + Math.random() * 0.015,
      color: Math.random() > 0.7
        ? [255, 182, 193]
        : Math.random() > 0.5
          ? [200, 180, 255]
          : [255, 255, 255],
    });
  }

  var starFrame = 0;
  function animateStars() {
    starFrame++;
    if (lowPowerMode && starFrame % 2) {
      requestAnimationFrame(animateStars);
      return;
    }
    sctx.clearRect(0, 0, starCanvas.width, starCanvas.height);
    for (var i = 0; i < stars.length; i++) {
      var s = stars[i];
      s.phase += s.speed;
      var alpha = 0.2 + Math.sin(s.phase) * 0.4 + 0.4;
      sctx.beginPath();
      sctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
      sctx.fillStyle = 'rgba(' + s.color[0] + ',' + s.color[1] + ',' + s.color[2] + ',' + alpha + ')';
      sctx.fill();
      if (s.r > 1) {
        sctx.beginPath();
        sctx.arc(s.x, s.y, s.r * 2.5, 0, Math.PI * 2);
        sctx.fillStyle = 'rgba(' + s.color[0] + ',' + s.color[1] + ',' + s.color[2] + ',' + (alpha * 0.15) + ')';
        sctx.fill();
      }
    }
    requestAnimationFrame(animateStars);
  }
  animateStars();
})();

/* â”€â”€ Magical Floating Orbs â”€â”€ */
(function initOrbs() {
  var orbCount = lowPowerMode ? 1 : ((window.innerWidth <= 600) ? 2 : 3);
  for (var i = 0; i < orbCount; i++) {
    var orb = document.createElement('div');
    orb.className = 'magic-orb';
    var size = 100 + Math.random() * 200;
    orb.style.width = size + 'px';
    orb.style.height = size + 'px';
    orb.style.left = (Math.random() * 80 + 10) + '%';
    orb.style.top = (Math.random() * 80 + 10) + '%';
    orb.style.animationDelay = (Math.random() * 5) + 's';
    orb.style.animationDuration = (6 + Math.random() * 6) + 's';
    document.body.appendChild(orb);
  }
})();

/* â”€â”€ Heart Particle System â”€â”€ */
var canvas = document.getElementById('heart-canvas');
var ctx = canvas.getContext('2d');
var W, H;
var hearts = [];
var musicMode = false;
var scrollProgress = 0;
var beatEnergy = 0;
var MAX_HEARTS = (window.innerWidth <= 600)
  ? (lowPowerMode ? 160 : 240)
  : (lowPowerMode ? 320 : 520);

function capHearts() {
  if (hearts.length > MAX_HEARTS) {
    hearts.splice(0, hearts.length - MAX_HEARTS);
  }
}

var DEFAULT_HEART_COLORS = [
  [255,105,180], [255,69,100], [255,182,193],
  [238,130,238], [255,140,160], [255,200,220],
  [200,100,255], [255,80,120],  [255,220,230],
  [255,20,100],  [180,60,200],
];

var RAINBOW_HEART_COLORS = [
  [228,3,3],     [255,60,40],
  [255,140,0],   [255,170,50],
  [255,237,0],   [255,255,80],
  [0,128,38],    [0,180,80],
  [0,77,255],    [60,120,255],
  [117,7,135],   [180,60,220],
];

var COLORS = DEFAULT_HEART_COLORS.slice();

function setHeartColors(mode) {
  COLORS.length = 0;
  var src = mode === 'rainbow' ? RAINBOW_HEART_COLORS : DEFAULT_HEART_COLORS;
  for (var i = 0; i < src.length; i++) COLORS.push(src[i]);
}

if (currentVariationConfig && currentVariationConfig.heartColors === 'rainbow') {
  setHeartColors('rainbow');
}

function resize() {
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

window.addEventListener('scroll', function() {
  var docHeight = document.documentElement.scrollHeight - window.innerHeight;
  scrollProgress = docHeight > 0 ? Math.min(1, window.scrollY / docHeight) : 0;
}, { passive: true });

function drawHeart(cx, cy, size, angle, color, alpha) {
  ctx.save();
  ctx.translate(cx, cy);
  ctx.rotate(angle);
  ctx.globalAlpha = alpha;
  ctx.fillStyle = 'rgb(' + color[0] + ',' + color[1] + ',' + color[2] + ')';
  ctx.beginPath();
  var s = size;
  ctx.moveTo(0, -s * 0.35);
  ctx.bezierCurveTo(-s * 0.5, -s * 0.9, -s * 1.3, -s * 0.4, 0, s * 0.6);
  ctx.bezierCurveTo(s * 1.3, -s * 0.4, s * 0.5, -s * 0.9, 0, -s * 0.35);
  ctx.fill();
  ctx.globalAlpha = alpha * 0.3;
  ctx.fillStyle = 'rgb(' + Math.min(255,color[0]+60) + ',' + Math.min(255,color[1]+60) + ',' + Math.min(255,color[2]+60) + ')';
  ctx.beginPath();
  var gs = size * 0.5;
  ctx.moveTo(0, -gs * 0.35);
  ctx.bezierCurveTo(-gs * 0.5, -gs * 0.9, -gs * 1.3, -gs * 0.4, 0, gs * 0.6);
  ctx.bezierCurveTo(gs * 1.3, -gs * 0.4, gs * 0.5, -gs * 0.9, 0, -gs * 0.35);
  ctx.fill();
  ctx.restore();
}

function Heart(x, y, burst) {
  this.x = x || Math.random() * W;
  this.y = y || -20 - Math.random() * 100;
  this.size = 8 + Math.random() * 24;
  this.color = COLORS[Math.floor(Math.random() * COLORS.length)];
  this.angle = (Math.random() - 0.5) * 0.8;
  this.rotSpeed = (Math.random() - 0.5) * 0.03;
  this.vy = burst ? (Math.random() - 0.5) * 6 : 0.3 + Math.random() * 1.2;
  this.vx = burst ? (Math.random() - 0.5) * 6 : (Math.random() - 0.5) * 0.5;
  this.gravity = 0.02 + Math.random() * 0.01;
  this.opacity = 0.4 + Math.random() * 0.6;
  this.fadeSpeed = burst ? 0.008 + Math.random() * 0.005 : 0.0005;
  this.wobblePhase = Math.random() * Math.PI * 2;
  this.wobbleSpeed = 0.01 + Math.random() * 0.02;
  this.wobbleAmp = 0.3 + Math.random() * 0.5;
  this.burst = burst || false;
  this.life = 1;
}
Heart.prototype.update = function() {
  this.wobblePhase += this.wobbleSpeed;
  this.vx += Math.sin(this.wobblePhase) * this.wobbleAmp * 0.01;
  if (!this.burst) this.vy += this.gravity;
  else this.vy += this.gravity * 2;
  this.x += this.vx;
  this.y += this.vy;
  this.angle += this.rotSpeed;
  this.life -= this.fadeSpeed;
  if (this.y > H - this.size) {
    this.y = H - this.size;
    this.vy *= -0.4;
    this.vx *= 0.9;
  }
  if (this.x < this.size || this.x > W - this.size) {
    this.vx *= -0.7;
    this.x = Math.max(this.size, Math.min(W - this.size, this.x));
  }
  return this.life > 0 && this.y < H + 50;
};
Heart.prototype.draw = function() {
  drawHeart(this.x, this.y, this.size, this.angle, this.color, this.life * this.opacity);
};

function collide(a, b) {
  var dx = a.x - b.x;
  var dy = a.y - b.y;
  var dist = Math.sqrt(dx * dx + dy * dy);
  var minDist = (a.size + b.size) * 0.6;
  if (dist < minDist && dist > 0) {
    var nx = dx / dist;
    var ny = dy / dist;
    var overlap = minDist - dist;
    a.x += nx * overlap * 0.5;
    a.y += ny * overlap * 0.5;
    b.x -= nx * overlap * 0.5;
    b.y -= ny * overlap * 0.5;
    var dvx = a.vx - b.vx;
    var dvy = a.vy - b.vy;
    var dot = dvx * nx + dvy * ny;
    if (dot > 0) {
      a.vx -= dot * nx * 0.5;
      a.vy -= dot * ny * 0.5;
      b.vx += dot * nx * 0.5;
      b.vy += dot * ny * 0.5;
      a.rotSpeed += (Math.random() - 0.5) * 0.02;
      b.rotSpeed += (Math.random() - 0.5) * 0.02;
    }
  }
}

var spawnTimer = 0;
var heartFrame = 0;
function animate() {
  heartFrame++;
  if (lowPowerMode && heartFrame % 2) {
    requestAnimationFrame(animate);
    return;
  }
  ctx.clearRect(0, 0, W, H);
  spawnTimer++;
  var baseMusicRate = musicMode ? 2 : 4;
  var baseNormalRate = musicMode ? 4 : 12;
  var topRate = musicMode ? baseMusicRate : baseNormalRate;
  var bottomRate = musicMode ? 30 : 80;
  var spawnRate = Math.round(topRate + (bottomRate - topRate) * Math.pow(scrollProgress, 0.7));

  if (spawnTimer >= spawnRate) {
    spawnTimer = 0;
    hearts.push(new Heart());
    if (scrollProgress < 0.2 && musicMode) {
      hearts.push(new Heart());
    }
    capHearts();
  }

  hearts = hearts.filter(function(h) { return h.update(); });

  for (var i = 0; i < hearts.length; i++) {
    for (var j = i + 1; j < Math.min(i + 8, hearts.length); j++) {
      collide(hearts[i], hearts[j]);
    }
  }

  if (musicMode && !reduceMotion) {
    beatEnergy = Math.max(0, beatEnergy - 0.05);
    if (beatEnergy > 0.001) {
      var accent = (currentVariationConfig && currentVariationConfig.accentColor) ? currentVariationConfig.accentColor : [255,105,180];
      var mult = (extraMode && currentVariationId !== 'kids') ? 1.8 : 1;
      var pulse = 0.006 + beatEnergy * 0.02 * mult;
      ctx.fillStyle = 'rgba(' + accent[0] + ',' + accent[1] + ',' + accent[2] + ',' + pulse.toFixed(4) + ')';
      ctx.fillRect(0, 0, W, H);
    }
  }

  hearts.forEach(function(h) { h.draw(); });
  requestAnimationFrame(animate);
}
animate();

var touchBurstCount = (window.innerWidth <= 600) ? (lowPowerMode ? 4 : 6) : (lowPowerMode ? 8 : 12);
document.addEventListener('click', function(e) {
  if (e.target.closest('button') || e.target.closest('.yt-container') || e.target.closest('.tap-to-hear')) return;
  for (var i = 0; i < touchBurstCount; i++) {
    hearts.push(new Heart(e.clientX, e.clientY, true));
  }
  capHearts();
});

document.addEventListener('touchstart', function(e) {
  if (e.target.closest('button') || e.target.closest('.yt-container') || e.target.closest('.tap-to-hear')) return;
  var t = e.touches[0];
  for (var i = 0; i < touchBurstCount; i++) {
    hearts.push(new Heart(t.clientX, t.clientY, true));
  }
  capHearts();
}, { passive: true });

/* â”€â”€ Scroll Reveal â”€â”€ */
var observer = new IntersectionObserver(function(entries) {
  entries.forEach(function(e) {
    if (e.isIntersecting) e.target.classList.add('visible');
  });
}, { threshold: 0.15 });
var __sections = document.querySelectorAll('.section');
for (var __i = 0; __i < __sections.length; __i++) observer.observe(__sections[__i]);

/* â”€â”€ Haptics Engine â€” syncs vibration to song BPM with variation patterns â”€â”€ */
var hapticsInterval = null;
var hapticPulseEl = document.getElementById('haptic-pulse');
var hapticsStatusEl = document.getElementById('haptics-status');
var beatPulseTimer = null;
var isiPhone = /iPhone|iPad|iPod/.test(navigator.userAgent) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
var hasVibrationApi = typeof navigator.vibrate === 'function';
var hasIOSHapticBridge = !!(window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.haptics);

function setHapticsStatus(message) {
  if (!hapticsStatusEl) return;
  hapticsStatusEl.textContent = message || '';
  hapticsStatusEl.classList.toggle('visible', !!message);
}

function pulseVisualBeat() {
  if (hapticPulseEl) {
    hapticPulseEl.classList.add('active');
    setTimeout(function() { hapticPulseEl.classList.remove('active'); }, 150);
  }
  var extraEnabled = !!(extraMode && currentVariationId !== 'kids');
  beatEnergy = Math.min(1, beatEnergy + (extraEnabled ? 1 : 0.9));
  if (reduceMotion) return;

  document.body.classList.add('beat-hit');
  if (beatPulseTimer) clearTimeout(beatPulseTimer);
  beatPulseTimer = setTimeout(function() {
    document.body.classList.remove('beat-hit');
    beatPulseTimer = null;
  }, 140);

  if (extraEnabled) {
    /* A second, smaller after-pulse for "overwhelming" feel */
    setTimeout(function() {
      if (reduceMotion) return;
      document.body.classList.add('beat-hit');
      setTimeout(function() { document.body.classList.remove('beat-hit'); }, 120);
    }, 120);
    triggerExtraTone();
  }

  if (document.body.classList.contains('mobile-version')) {
    document.body.classList.add('beat-pulse');
    setTimeout(function() { document.body.classList.remove('beat-pulse'); }, 120);
  }
}

function triggerBeatHaptics(pattern) {
  var didTriggerHardwareHaptic = false;

  if (hasVibrationApi) {
    try {
      navigator.vibrate(pattern);
      didTriggerHardwareHaptic = true;
    } catch (e) {}
  } else if (hasIOSHapticBridge) {
    try {
      window.webkit.messageHandlers.haptics.postMessage({ pattern: pattern });
      didTriggerHardwareHaptic = true;
    } catch (e) {}
  }

  if (!didTriggerHardwareHaptic && isiPhone) {
    setHapticsStatus('iPhone Safari blocks vibration API. Beat pulse fallback is active.');
  } else if (didTriggerHardwareHaptic) {
    setHapticsStatus('');
  }

  pulseVisualBeat();
}

function startHaptics(bpm) {
  stopHaptics();
  if (!bpm) return;
  if (document.hidden) return;
  var beatMs = Math.round(60000 / bpm);
  var basePattern = (currentVariationConfig && currentVariationConfig.vibrationPattern)
    ? currentVariationConfig.vibrationPattern
    : [40, 30, 40];
  var pattern = basePattern;
  if (extraMode && currentVariationId !== 'kids') {
    var extra = (currentVariationConfig && currentVariationConfig.extraVibrationPattern)
      ? currentVariationConfig.extraVibrationPattern
      : basePattern.concat([20, 15, 25, 15, 30]);
    pattern = extra;
  }

  function normalizePatternToBeat(pat) {
    if (!pat || !pat.length) return [40, 30, 40];
    var total = 0;
    for (var i = 0; i < pat.length; i++) total += Math.max(0, pat[i] | 0);
    var maxTotal = Math.max(120, Math.floor(beatMs * 0.7));
    if (total <= maxTotal) return pat;
    var scale = maxTotal / Math.max(1, total);
    var out = [];
    for (var j = 0; j < pat.length; j++) out.push(Math.max(5, Math.round(pat[j] * scale)));
    return out;
  }
  pattern = normalizePatternToBeat(pattern);

  function doBeat() {
    if (document.hidden) return;
    triggerBeatHaptics(pattern);
  }

  doBeat();
  hapticsInterval = setInterval(doBeat, beatMs);
}

function stopHaptics() {
  if (hapticsInterval) {
    clearInterval(hapticsInterval);
    hapticsInterval = null;
  }
  try {
    if (hasVibrationApi) navigator.vibrate(0);
    if (hasIOSHapticBridge) window.webkit.messageHandlers.haptics.postMessage({ stop: true });
  } catch(e) {}
  if (hapticPulseEl) hapticPulseEl.classList.remove('active');
  document.body.classList.remove('beat-pulse');
  stopExtraTone();
}

if (isiPhone && !hasVibrationApi && !hasIOSHapticBridge) {
  setHapticsStatus('iPhone Safari blocks vibration API. Beat pulse fallback is active.');
}

document.addEventListener('visibilitychange', function() {
  if (document.hidden) {
    stopHaptics();
  } else if (audioUnlocked && musicMode && currentVariationConfig && currentVariationConfig.bpm) {
    startHaptics(currentVariationConfig.bpm);
  }
});

/* â”€â”€ Detonation Effect â€” the "bomb" moment â”€â”€ */
function runLoveQuake() {
  if (reduceMotion) return;
  var content = document.querySelector('.content');
  if (!content || !content.animate) return;
  try {
    content.animate([
      { transform: 'translate3d(0,0,0)' },
      { transform: 'translate3d(-2px,1px,0)' },
      { transform: 'translate3d(2px,-1px,0)' },
      { transform: 'translate3d(-3px,2px,0)' },
      { transform: 'translate3d(3px,-2px,0)' },
      { transform: 'translate3d(-1px,1px,0)' },
      { transform: 'translate3d(0,0,0)' }
    ], { duration: 650, easing: 'ease-out' });
  } catch (e) {}
}

function detonateLoveBomb() {
  runLoveQuake();
  var flash = document.createElement('div');
  flash.className = 'detonate-flash';
  document.body.appendChild(flash);
  setTimeout(function() { flash.remove(); }, 2000);

  var detonateCount = (W <= 600) ? (lowPowerMode ? 18 : 30) : (lowPowerMode ? 50 : 80);
  for (var i = 0; i < detonateCount; i++) {
    (function(idx) {
      setTimeout(function() {
        hearts.push(new Heart(
          W * 0.2 + Math.random() * W * 0.6,
          H * 0.2 + Math.random() * H * 0.6,
          true
        ));
        capHearts();
      }, idx * 20);
    })(i);
  }

  triggerBeatHaptics([60, 20, 60, 20, 60, 20, 80, 40, 120, 60, 200]);

  if (currentVariationConfig && currentVariationConfig.bpm) {
    setTimeout(function() {
      startHaptics(currentVariationConfig.bpm);
    }, 800);
  }
}

/* â”€â”€ YouTube Player â€” variation-aware autoplay with ad-delay and loop â”€â”€ */
var ytPlayer = null;
var ytReady = false;
var userHasInteracted = false;
var audioUnlocked = false;
var unmuteReady = false;
var unmuteCountdownInterval = null;
var AD_GRACE_PERIOD_SEC = 30;
var hasDetonatedForTrack = false;
var lastUnlockGestureMs = 0;
var activeVideoIdOverride = null;
var videoRecoveryAttempted = false;
var videoFallbackByVariation = {
  multilang: ['Hwot-sobbFQ'],
};

var tag = document.createElement('script');
tag.src = 'https://www.youtube.com/iframe_api';
document.head.appendChild(tag);

function getVideoConfig() {
  var cfg = currentVariationConfig || LOVE_BOMB_VARIATIONS['default'];
  var selectedVideoId = activeVideoIdOverride || cfg.videoId || 'NI6aOFI7hms';
  return {
    videoId: selectedVideoId,
    start: activeVideoIdOverride ? 0 : (cfg.videoStart || 0),
  };
}

function getFallbackVideoId() {
  var cfg = currentVariationConfig || LOVE_BOMB_VARIATIONS['default'];
  var currentVideoId = activeVideoIdOverride || cfg.videoId;
  var candidates = [];

  if (cfg.fallbackVideoIds && cfg.fallbackVideoIds.length) {
    candidates = candidates.concat(cfg.fallbackVideoIds);
  }
  if (videoFallbackByVariation[currentVariationId]) {
    candidates = candidates.concat(videoFallbackByVariation[currentVariationId]);
  }

  var defaultVideoId = (LOVE_BOMB_VARIATIONS['default'] && LOVE_BOMB_VARIATIONS['default'].videoId) || 'NI6aOFI7hms';
  candidates.push(defaultVideoId);

  for (var i = 0; i < candidates.length; i++) {
    var id = candidates[i];
    if (id && id !== currentVideoId) return id;
  }
  return null;
}

function recoverVideoPlayback(errorCode) {
  if (!ytPlayer || !ytReady || videoRecoveryAttempted) return;
  var fallbackId = getFallbackVideoId();
  if (!fallbackId) return;

  videoRecoveryAttempted = true;
  activeVideoIdOverride = fallbackId;
  audioUnlocked = false;
  hasDetonatedForTrack = false;
  stopHaptics();

  try {
    ytPlayer.loadVideoById({ videoId: fallbackId, startSeconds: 0 });
    ytPlayer.mute();
    startUnmuteCountdown();
    showUnmuteControls();
    var label = document.getElementById('unmute-label');
    if (label) {
      label.textContent = 'Tap to start music';
    }
    console.warn('Recovered video playback after YouTube error code:', errorCode);
  } catch (e) {}
}

var __oembedCache = {};
var __oembedInflight = {};
function __setSongInfo(el, artist, title, note) {
  if (!el) return;
  while (el.firstChild) el.removeChild(el.firstChild);
  var prefix = 'â™ª ';
  if (note) prefix = prefix + note + ' Â· ';
  if (artist) {
    el.appendChild(document.createTextNode(prefix + artist + ' â€” '));
  } else {
    el.appendChild(document.createTextNode(prefix));
  }
  var em = document.createElement('em');
  em.textContent = title || '';
  el.appendChild(em);
  setTimeout(function() { el.classList.add('visible'); }, 100);
}
function __fetchOembed(videoId, cb) {
  if (!videoId) return cb(null);
  if (__oembedCache[videoId]) return cb(__oembedCache[videoId]);
  if (__oembedInflight[videoId]) return __oembedInflight[videoId].push(cb);
  if (!window.fetch) return cb(null);

  __oembedInflight[videoId] = [cb];
  var url = 'https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=' + encodeURIComponent(videoId) + '&format=json';
  function done() {
    var list = __oembedInflight[videoId] || [];
    delete __oembedInflight[videoId];
    for (var i = 0; i < list.length; i++) {
      try { list[i](__oembedCache[videoId]); } catch (e) {}
    }
  }
  fetch(url)
    .then(function(r) { return r.ok ? r.json() : null; })
    .then(function(data) {
      if (data && data.title) {
        __oembedCache[videoId] = { title: data.title, author: data.author_name || '' };
      } else {
        __oembedCache[videoId] = null;
      }
      done();
    })
    .catch(function() {
      __oembedCache[videoId] = null;
      done();
    });
}

function updateSongInfo() {
  var el = document.getElementById('song-info');
  if (!el || !currentVariationConfig) return;
  var cfg = currentVariationConfig;
  var title = cfg.songTitle;
  var artist = cfg.songArtist;
  var intendedId = cfg.videoId;
  var actualId = activeVideoIdOverride || intendedId;
  var isFallback = !!(activeVideoIdOverride && intendedId && activeVideoIdOverride !== intendedId);

  if (isFallback) {
    __setSongInfo(el, '', 'Loading fallback trackâ€¦', 'Fallback');
    __fetchOembed(actualId, function(info) {
      if (!el) return;
      if (info && info.title) {
        __setSongInfo(el, info.author || '', info.title, 'Fallback video');
      } else {
        __setSongInfo(el, artist || '', title || 'Fallback video', 'Fallback');
      }
    });
    return;
  }

  if (title && artist) {
    __setSongInfo(el, artist, title, '');
  } else {
    el.textContent = '';
    el.classList.remove('visible');
  }
}

function hideUnmuteControls() {
  var tapBtn = document.getElementById('tap-to-hear');
  var unmuteBtn = document.getElementById('unmute-btn');
  if (tapBtn) tapBtn.classList.add('hidden');
  if (unmuteBtn) unmuteBtn.style.display = 'none';
  if (unmuteCountdownInterval) {
    clearInterval(unmuteCountdownInterval);
    unmuteCountdownInterval = null;
  }
}

function showUnmuteControls() {
  var tapBtn = document.getElementById('tap-to-hear');
  if (tapBtn) tapBtn.classList.remove('hidden');
}

function startUnmuteCountdown() {
  var btn = document.getElementById('unmute-btn');
  var label = document.getElementById('unmute-label');
  if (!btn || !label) return;
  unmuteReady = true;
  btn.disabled = false;
  btn.classList.add('ready');
  btn.style.display = '';
  var icon = btn.querySelector('.unmute-icon');
  if (icon) icon.textContent = '\uD83D\uDD0A';
  label.textContent = 'Turn on music';
}

function tryUnmutePlayer() {
  if (!ytPlayer || !ytReady || audioUnlocked) return;
  try {
    ytPlayer.playVideo();
    ytPlayer.unMute();
    ytPlayer.setVolume(100);
  } catch(e) {}
  setTimeout(function() {
    try {
      if (ytPlayer.isMuted && !ytPlayer.isMuted()) {
        audioUnlocked = true;
        hideUnmuteControls();
        if (!hasDetonatedForTrack) {
          detonateLoveBomb();
          hasDetonatedForTrack = true;
        }
      } else {
        audioUnlocked = false;
        showUnmuteControls();
      }
    } catch(e) {}
  }, 220);
}

function attemptAudioUnlockFromGesture() {
  if (!ytPlayer || !ytReady) return;
  userHasInteracted = true;
  try {
    ytPlayer.playVideo();
    ytPlayer.unMute();
    ytPlayer.setVolume(100);
  } catch(e) {}
  setTimeout(function() {
    var unlocked = false;
    try {
      unlocked = ytPlayer.isMuted && !ytPlayer.isMuted();
    } catch (err) {}
    if (unlocked) {
      audioUnlocked = true;
      hideUnmuteControls();
      if (!hasDetonatedForTrack) {
        detonateLoveBomb();
        hasDetonatedForTrack = true;
      }
      if (!hapticsInterval && currentVariationConfig && currentVariationConfig.bpm) {
        startHaptics(currentVariationConfig.bpm);
      }
    } else {
      audioUnlocked = false;
      showUnmuteControls();
    }
  }, 220);
}

function createPlayer() {
  var vc = getVideoConfig();
  ytPlayer = new YT.Player('yt-player', {
    height: '100%',
    width: '100%',
    videoId: vc.videoId,
    playerVars: {
      autoplay: 1,
      start: vc.start || 0,
      mute: 1,
      loop: 1,
      playlist: vc.videoId,
      modestbranding: 1,
      rel: 0,
      playsinline: 1,
    },
    events: {
      onReady: function(event) {
        ytReady = true;
        videoRecoveryAttempted = false;
        hasDetonatedForTrack = false;
        unmuteReady = true;
        var container = document.getElementById('yt-container');
        container.classList.add('active');
        event.target.mute();
        event.target.playVideo();
        musicMode = true;
        updateSongInfo();
        showUnmuteControls();

        setTimeout(function() {
          try {
            if (ytPlayer.isMuted()) {
              showUnmuteControls();
            } else {
              audioUnlocked = true;
              hideUnmuteControls();
              if (!hasDetonatedForTrack) {
                detonateLoveBomb();
                hasDetonatedForTrack = true;
              }
            }
          } catch(e) {}
        }, 500);
      },
      onStateChange: function(e) {
        musicMode = (e.data === YT.PlayerState.PLAYING);
        if (e.data === YT.PlayerState.ENDED) {
          var vc = getVideoConfig();
          try {
            ytPlayer.seekTo(vc.start || 0, true);
            ytPlayer.playVideo();
          } catch (err) {}
          return;
        }
        if (e.data === YT.PlayerState.PLAYING) {
          if (userHasInteracted && !audioUnlocked) {
            tryUnmutePlayer();
          }
          if (audioUnlocked && !hapticsInterval && currentVariationConfig && currentVariationConfig.bpm) {
            startHaptics(currentVariationConfig.bpm);
          }
        } else {
          stopHaptics();
        }
      },
      onError: function(e) {
        recoverVideoPlayback(e.data);
      },
    }
  });
}

function loadVariationVideo() {
  if (!ytPlayer || !ytReady) return;
  activeVideoIdOverride = null;
  videoRecoveryAttempted = false;
  var vc = getVideoConfig();
  audioUnlocked = false;
  hasDetonatedForTrack = false;
  unmuteReady = false;
  stopHaptics();
  try {
    ytPlayer.loadVideoById({ videoId: vc.videoId, startSeconds: vc.start });
    ytPlayer.mute();
    updateSongInfo();
    startUnmuteCountdown();
    showUnmuteControls();
  } catch(e) {}
}

window.onYouTubeIframeAPIReady = function() {
  createPlayer();
};

function onUserInteraction() {
  var now = Date.now();
  if (now - lastUnlockGestureMs < 250) return;
  lastUnlockGestureMs = now;
  userHasInteracted = true;
  if (ytPlayer && ytReady) attemptAudioUnlockFromGesture();
}

/* â”€â”€ Extra mode tones (beat-synced blips) â”€â”€ */
var extraToneCtx = null;
var extraToneGain = null;
var extraToneUnlocked = false;
function unlockExtraTone() {
  if (!extraMode) return;
  if (reduceMotion) {} /* no-op: audio isn't motion, but keep consistency */
  if (extraToneCtx && extraToneCtx.state === 'running') {
    extraToneUnlocked = true;
    return;
  }
  try {
    var Ctx = window.AudioContext || window.webkitAudioContext;
    if (!Ctx) return;
    if (!extraToneCtx) {
      extraToneCtx = new Ctx();
      extraToneGain = extraToneCtx.createGain();
      extraToneGain.gain.value = 0.0;
      extraToneGain.connect(extraToneCtx.destination);
    }
    if (extraToneCtx.state === 'suspended' && extraToneCtx.resume) {
      extraToneCtx.resume().then(function() { extraToneUnlocked = true; }).catch(function() {});
    } else {
      extraToneUnlocked = true;
    }
  } catch (e) {}
}

function stopExtraTone() {
  if (extraToneGain) {
    try { extraToneGain.gain.setTargetAtTime(0.0, extraToneCtx.currentTime, 0.02); } catch (e) {}
  }
}

function triggerExtraTone() {
  if (!extraMode) return;
  if (!userHasInteracted) return;
  if (!audioUnlocked) return;
  unlockExtraTone();
  if (!extraToneCtx || !extraToneGain || !extraToneUnlocked) return;

  try {
    var now = extraToneCtx.currentTime;
    var osc = extraToneCtx.createOscillator();
    var accent = (currentVariationConfig && currentVariationConfig.accentHue) ? currentVariationConfig.accentHue : 330;
    var freq = 220 + ((accent % 360) / 360) * 660; /* 220â€“880Hz */
    osc.type = extraMode ? 'square' : 'sine';
    osc.frequency.setValueAtTime(freq, now);

    var g = extraToneCtx.createGain();
    g.gain.setValueAtTime(0.0001, now);
    g.gain.exponentialRampToValueAtTime(0.03, now + 0.01);
    g.gain.exponentialRampToValueAtTime(0.0001, now + 0.06);
    osc.connect(g);
    g.connect(extraToneGain);
    extraToneGain.gain.setTargetAtTime(0.35, now, 0.01);
    osc.start(now);
    osc.stop(now + 0.07);
    osc.onended = function() {
      try { g.disconnect(); } catch (e) {}
      try { osc.disconnect(); } catch (e) {}
    };
  } catch (e) {}
}

var tapToHearEl = document.getElementById('tap-to-hear');
if (tapToHearEl) {
  tapToHearEl.addEventListener('click', function(e) {
    e.stopPropagation();
    onUserInteraction();
  });
  tapToHearEl.addEventListener('touchend', function(e) {
    e.preventDefault();
    e.stopPropagation();
    onUserInteraction();
  }, { passive: false });
  tapToHearEl.addEventListener('keydown', function(e) {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      onUserInteraction();
    }
  });
}

var unmuteBtnEl = document.getElementById('unmute-btn');
if (unmuteBtnEl) {
  unmuteBtnEl.addEventListener('click', function(e) {
    e.stopPropagation();
    onUserInteraction();
  });
  unmuteBtnEl.addEventListener('touchend', function(e) {
    e.preventDefault();
    e.stopPropagation();
    onUserInteraction();
  }, { passive: false });
}

document.addEventListener('scroll', function onFirstScroll() {
  if (unmuteReady) onUserInteraction();
  document.removeEventListener('scroll', onFirstScroll);
}, {passive: true});

/* â”€â”€ Love Bomb Counter â”€â”€ */
(function initCounter() {
  var LAUNCH_DATE = new Date('2025-06-01T00:00:00Z');
  var BASE_COUNT = 1300;
  var PRIMES = [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47];

  function seededRandom(seed) {
    var t = seed + 0x6D2B79F5;
    t = Math.imul(t ^ (t >>> 15), t | 1);
    t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
    return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
  }

  function calculateCount() {
    var now = new Date();
    var msPerDay = 86400000;
    var daysSinceLaunch = Math.max(0, Math.floor((now - LAUNCH_DATE) / msPerDay));
    var total = BASE_COUNT;

    for (var day = 0; day <= daysSinceLaunch; day++) {
      var seed = day * 31337 + 7919;
      var rand = seededRandom(seed);
      var progress = Math.min(1, day / 365);
      var primeIndex = Math.floor((1 - progress) * (PRIMES.length - 1));
      var prime = PRIMES[primeIndex];
      var maxDailyAdds = 4320;
      var dailyBase = 1 + (maxDailyAdds - 1) * Math.pow(progress, 3);
      var dailyIncrement = Math.floor((dailyBase / prime) * (0.6 + rand * 0.8));
      total += Math.max(1, dailyIncrement);
    }

    if (daysSinceLaunch > 0) {
      var progress = Math.min(1, daysSinceLaunch / 365);
      var maxPerMin = 3 * Math.pow(progress, 3);
      var minutesToday = now.getHours() * 60 + now.getMinutes();
      var seed = daysSinceLaunch * 99991 + minutesToday;
      var rand = seededRandom(seed);
      var intradayPrime = PRIMES[Math.floor(rand * 5)];
      var intradayAdds = Math.floor((minutesToday * maxPerMin) / intradayPrime);
      total += Math.max(0, intradayAdds);
    }

    return total;
  }

  function formatNumber(n) {
    return n.toLocaleString('en-US');
  }

  function updateCounter() {
    var el = document.getElementById('love-counter');
    if (el) {
      el.textContent = formatNumber(calculateCount());
    }
  }

  updateCounter();
  function scheduleNext() {
    var delay = 20000 + Math.random() * 20000;
    setTimeout(function() {
      updateCounter();
      scheduleNext();
    }, delay);
  }
  scheduleNext();
})();

/* â”€â”€ Variation System â€” handles video, hearts, sculpture, haptics â”€â”€ */
(function initVariations() {
  var params = new URLSearchParams(window.location.search);
  var varId = currentVariationId;

  function applyVariation(id, isSwitch) {
    var c = LOVE_BOMB_VARIATIONS[id] || LOVE_BOMB_VARIATIONS['default'];
    currentVariationId = id;
    currentVariationConfig = c;

    var from = document.getElementById('var-from');
    var to = document.getElementById('var-to');
    var re = document.getElementById('var-re');
    var hookSub = document.getElementById('variation-hook-sub');
    var worldNote = document.getElementById('variation-world-note');
    if (from && c.telegramFrom) from.textContent = c.telegramFrom;
    if (to && c.telegramTo) to.textContent = c.telegramTo;
    if (re && c.telegramRe) re.textContent = c.telegramRe;
    if (hookSub) {
      hookSub.textContent = c.hookSub || '';
      hookSub.style.display = c.hookSub ? 'block' : 'none';
    }
    if (worldNote && c.worldPeaceNote) worldNote.textContent = c.worldPeaceNote;
    var vBtns = document.querySelectorAll('.variation-btn');
    for (var bi = 0; bi < vBtns.length; bi++) {
      var btn = vBtns[bi];
      btn.classList.toggle('active', btn.dataset.var === id);
    }

    /* Per-variation body class */
    Object.keys(LOVE_BOMB_VARIATIONS).forEach(function(k) {
      var vc = LOVE_BOMB_VARIATIONS[k];
      if (vc.bodyClass) document.body.classList.remove(vc.bodyClass);
    });
    if (c.bodyClass) document.body.classList.add(c.bodyClass);

    /* Per-variation CSS custom properties */
    if (c.accentColor) {
      document.documentElement.style.setProperty('--accent', c.accentColor.join(','));
    }

    /* Rainbow hearts for LGBTQ */
    if (c.heartColors === 'rainbow') {
      setHeartColors('rainbow');
      document.body.classList.add('rainbow-active');
    } else {
      setHeartColors('default');
      document.body.classList.remove('rainbow-active');
    }

    /* Philly LOVE sculpture */
    var sculpture = document.getElementById('love-sculpture');
    if (sculpture) {
      if (c.showLoveSculpture) {
        sculpture.classList.add('active');
      } else {
        sculpture.classList.remove('active');
      }
    }

    /* Star Wars-ish love scene */
    var swScene = document.getElementById('starwars-scene');
    if (swScene) {
      if (id === 'starwars') {
        swScene.classList.add('active');
        swScene.setAttribute('aria-hidden', 'false');
      } else {
        swScene.classList.remove('active');
        swScene.setAttribute('aria-hidden', 'true');
      }
    }

    /* Song info */
    updateSongInfo();

    /* Load new video if switching */
    if (isSwitch) {
      loadVariationVideo();
    }

    /* Update URL */
    if (id !== (params.get('v') || 'default')) {
      var u = new URL(window.location.href);
      u.searchParams.set('v', id);
      window.history.replaceState({}, '', u.toString());
    }

    /* Kid-friendly lockdown: no top links, no extra mode */
    var picker = document.getElementById('variation-picker');
    if (picker) {
      picker.style.display = (id === 'kids') ? 'none' : '';
    }
    if (id === 'kids') {
      document.body.classList.remove('extra-mode');
      try { if (window.__refreshExtraModeEffective) window.__refreshExtraModeEffective(); } catch (e) {}
      stopExtraTone();
    } else {
      try { if (window.__refreshExtraModeEffective) window.__refreshExtraModeEffective(); } catch (e) {}
    }
  }

  var btns = document.getElementById('variation-btns');
  if (btns) {
    ['default','friend','kids','philly','nyc','usa','lgbtq','multilang','starwars'].forEach(function(id) {
      var c = LOVE_BOMB_VARIATIONS[id];
      if (!c) return;
      var b = document.createElement('button');
      b.className = 'variation-btn' + (id === varId ? ' active' : '');
      b.dataset.var = id;
      b.textContent = c.label;
      b.addEventListener('click', function() { applyVariation(id, true); });
      btns.appendChild(b);
    });
  }
  applyVariation(varId, false);
})();

/* â”€â”€ Star Wars-ish interaction: love lasers save a planet â”€â”€ */
(function initStarWarsLove() {
  var starBtn = document.getElementById('love-star-btn');
  var planet = document.getElementById('love-planet');
  var layer = document.getElementById('laser-layer');
  var badge = document.getElementById('save-badge');
  if (!starBtn || !planet || !layer || !badge) return;

  var saving = false;
  var lastFireMs = 0;

  function showBadge(text) {
    while (badge.firstChild) badge.removeChild(badge.firstChild);
    var parts = ('' + text).split('LOVE');
    badge.appendChild(document.createTextNode(parts[0] || ''));
    var span = document.createElement('span');
    span.className = 'love-word';
    span.textContent = 'LOVE';
    badge.appendChild(span);
    badge.appendChild(document.createTextNode(parts.slice(1).join('LOVE') || ''));
    badge.classList.add('visible');
    setTimeout(function() { badge.classList.remove('visible'); }, 1400);
  }

  function fireLasers(count) {
    if (!layer) return;
    var beams = count || 8;
    var baseAngles = [-18, -8, 0, 10, 20, 32, -28, 44, -42, 56];
    for (var i = 0; i < beams; i++) {
      var b = document.createElement('div');
      b.className = 'love-laser';
      var ang = baseAngles[i % baseAngles.length] + (Math.random() * 10 - 5);
      b.style.setProperty('--ang', ang + 'deg');
      layer.appendChild(b);
      (function(el) {
        setTimeout(function() {
          try { el.remove(); } catch (e) {}
        }, 800);
      })(b);
    }
  }

  function savePlanetWithLove() {
    var now = Date.now();
    if (saving || (now - lastFireMs) < 450) return;
    lastFireMs = now;
    if (currentVariationId !== 'starwars') return;
    saving = true;

    onUserInteraction();
    runLoveQuake();

    var beamCount = (extraMode ? 14 : 9);
    fireLasers(beamCount);
    planet.classList.add('saved');
    showBadge('PLANET SAVED WITH LOVE');

    var burst = (W <= 600) ? (extraMode ? 16 : 10) : (extraMode ? 34 : 22);
    for (var i = 0; i < burst; i++) {
      hearts.push(new Heart(W * 0.68 + Math.random() * W * 0.26, H * 0.50 + Math.random() * H * 0.22, true));
    }
    capHearts();

    triggerBeatHaptics(extraMode ? [25, 10, 25, 10, 25, 10, 60, 25, 90] : [30, 20, 50, 30, 80]);

    setTimeout(function() {
      saving = false;
      if (!extraMode) {
        setTimeout(function() { planet.classList.remove('saved'); }, 2000);
      }
    }, 380);
  }

  starBtn.addEventListener('click', function(e) {
    e.preventDefault();
    savePlanetWithLove();
  });
  starBtn.addEventListener('touchend', function(e) {
    e.preventDefault();
    savePlanetWithLove();
  }, { passive: false });
})();

/* â”€â”€ Share Functions â”€â”€ */
function copyToClipboard(text) {
  if (navigator.clipboard && navigator.clipboard.writeText) {
    return navigator.clipboard.writeText(text);
  }
  return new Promise(function(resolve, reject) {
    try {
      var ta = document.createElement('textarea');
      ta.value = text;
      ta.setAttribute('readonly', '');
      ta.style.position = 'fixed';
      ta.style.top = '-1000px';
      ta.style.left = '-1000px';
      document.body.appendChild(ta);
      ta.focus();
      ta.select();
      ta.setSelectionRange(0, ta.value.length);
      var ok = document.execCommand('copy');
      ta.remove();
      if (ok) resolve();
      else reject(new Error('copy failed'));
    } catch (e) {
      reject(e);
    }
  });
}

function shareLoveBomb() {
  var url = window.location.href;
  var text = 'I\u2019m sending you a love bomb because you deserve to know you\u2019re loved. \u{1F48C}\n\nThis is for you. Every word. Open it:\n\n';
  if (navigator.share) {
    navigator.share({ title: 'You\u2019ve Been Love Bombed', text: text, url: url });
  } else {
    copyToClipboard(text + url).then(function() {
      var btn = document.querySelector('.share-btn');
      btn.textContent = '\u{1F48C} Copied! Now send it to someone you love.';
      setTimeout(function() { btn.innerHTML = '\u{1F48C}&ensp;Send a love bomb to someone you love'; }, 3000);
    }).catch(function() {
      alert('Copy failed. You can manually copy this link:\\n\\n' + url);
    });
  }
  var shareBurst = lowPowerMode ? 15 : 25;
  for (var i = 0; i < shareBurst; i++) {
    (function(idx) {
      setTimeout(function() {
        hearts.push(new Heart(Math.random()*W, H, true));
        capHearts();
      }, idx * 40);
    })(i);
  }
}

function copyLink() {
  var url = window.location.href;
  copyToClipboard(url).then(function() {
    var btn = document.querySelector('.share-link-btn');
    btn.textContent = '\u{1F517} Copied!';
    setTimeout(function() { btn.innerHTML = '\u{1F517}&ensp;Copy link'; }, 2000);
  }).catch(function() {
    alert('Copy failed. You can manually copy this link:\\n\\n' + url);
  });
}

/* â”€â”€ Sparkles on mouse move â”€â”€ */
var sparkleTimer = 0;
document.addEventListener('mousemove', function(e) {
  if (lowPowerMode || reduceMotion) return;
  sparkleTimer++;
  if (sparkleTimer % 3 !== 0) return;
  var s = document.createElement('div');
  s.className = 'sparkle';
  s.style.left = e.clientX + 'px';
  s.style.top = e.clientY + 'px';
  var c = COLORS[Math.floor(Math.random()*COLORS.length)];
  s.style.background = 'rgb(' + c[0] + ',' + c[1] + ',' + c[2] + ')';
  s.style.width = (2 + Math.random() * 4) + 'px';
  s.style.height = s.style.width;
  document.body.appendChild(s);
  setTimeout(function() { s.remove(); }, 3000);
});

/* â”€â”€ Love Sent Timestamp â€” shows when the love arrived â”€â”€ */
(function initTimestamp() {
  var el = document.getElementById('love-sent-time');
  if (!el) return;
  var now = new Date();
  var months = ['January','February','March','April','May','June','July','August','September','October','November','December'];
  var h = now.getHours();
  var ampm = h >= 12 ? 'PM' : 'AM';
  var h12 = h % 12 || 12;
  var min = now.getMinutes();
  var minStr = min < 10 ? '0' + min : '' + min;
  el.textContent = 'LOVE DELIVERED: ' + months[now.getMonth()] + ' ' + now.getDate() + ', ' + now.getFullYear() + ' AT ' + h12 + ':' + minStr + ' ' + ampm;
})();

/* â”€â”€ Bounce arrow animation â”€â”€ */
var style = document.createElement('style');
style.textContent = '@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(8px)}}';
document.head.appendChild(style);

/* â”€â”€ Felt-Not-Seen: warm welcome delay â”€â”€ */
(function warmWelcome() {
  var s1 = document.getElementById('s1');
  if (s1) {
    s1.style.transitionDelay = '0.4s';
  }
})();

/* â”€â”€ Felt-Not-Seen: tab title changes as you scroll deeper â”€â”€ */
(function initTitleLove() {
  var titles = [
    "You've Been Love Bombed \uD83D\uDC8C",
    "You are loved \u2764\uFE0F",
    "Someone is thinking of you \uD83D\uDC97",
    "You matter more than you know \u2728",
    "Don't forget: you are loved \uD83D\uDC8C"
  ];
  var lastIdx = 0;
  var origTitle = document.title;
  window.addEventListener('scroll', function() {
    var docH = document.documentElement.scrollHeight - window.innerHeight;
    var pct = docH > 0 ? window.scrollY / docH : 0;
    var idx = Math.min(titles.length - 1, Math.floor(pct * titles.length));
    if (idx !== lastIdx) {
      lastIdx = idx;
      document.title = titles[idx];
    }
  }, { passive: true });
  document.addEventListener('visibilitychange', function() {
    if (document.hidden) {
      document.title = "You're still loved \u2764\uFE0F";
    } else {
      document.title = titles[lastIdx] || origTitle;
    }
  });
})();

/* â”€â”€ Felt-Not-Seen: background warms as you scroll deeper â”€â”€ */
(function initWarmthGradient() {
  var aurora = document.querySelector('.aurora-overlay');
  if (!aurora) return;
  window.addEventListener('scroll', function() {
    var docH = document.documentElement.scrollHeight - window.innerHeight;
    var pct = docH > 0 ? Math.min(1, window.scrollY / docH) : 0;
    aurora.style.opacity = (0.6 + pct * 0.4).toFixed(2);
  }, {passive: true});
})();

/* â”€â”€ Staggered section reveal for enchanted feel â”€â”€ */
(function initStaggeredReveal() {
  var sections = document.querySelectorAll('.section');
  for (var si = 0; si < sections.length; si++) {
    (function(section) {
      var cards = section.querySelectorAll('.affirmation-card');
      if (cards.length <= 0) return;

      var cardObserver = new IntersectionObserver(function(entries) {
        for (var ei = 0; ei < entries.length; ei++) {
          var entry = entries[ei];
          if (!entry.isIntersecting) continue;
          for (var ci = 0; ci < cards.length; ci++) {
            (function(card, i) {
              setTimeout(function() {
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
              }, i * 120);
            })(cards[ci], ci);
          }
        }
      }, { threshold: 0.2 });
      cardObserver.observe(section);

      for (var i = 0; i < cards.length; i++) {
        var card = cards[i];
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
      }
    })(sections[si]);
  }
})();

/* â”€â”€ Personalization: ?from= URL parameter â”€â”€ */
(function initPersonalization() {
  var params = new URLSearchParams(window.location.search);
  var senderName = params.get('from');
  if (!senderName) return;
  senderName = ('' + senderName).substring(0, 50);

  var banner = document.getElementById('from-banner');
  if (banner) {
    banner.textContent = 'FROM ' + senderName.toUpperCase() + ', WITH ALL THEIR LOVE';
    banner.style.display = 'block';
  }

  var hookTitle = document.getElementById('hook-title');
  if (hookTitle) {
    while (hookTitle.firstChild) hookTitle.removeChild(hookTitle.firstChild);
    hookTitle.appendChild(document.createTextNode(senderName + ' just sent you'));
    hookTitle.appendChild(document.createElement('br'));
    hookTitle.appendChild(document.createTextNode('a love bomb.'));
  }

  var telegramFrom = document.getElementById('var-from');
  if (telegramFrom) {
    telegramFrom.textContent = senderName + ', who loves you';
  }
})();

/* â”€â”€ Touch Feedback: gentle vibration when tapping affirmation cards â”€â”€ */
(function initCardFeedback() {
  var cards = document.querySelectorAll('.affirmation-card');
  for (var i = 0; i < cards.length; i++) {
    (function(card) {
    card.addEventListener('click', function() {
      triggerBeatHaptics(15);
      card.style.transform = 'translateY(-4px) scale(1.02)';
      setTimeout(function() {
        card.style.transform = 'translateY(0) scale(1)';
      }, 300);
    });
    card.setAttribute('role', 'article');
    })(cards[i]);
  }
})();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
/* STAR WARS EPIC EXPERIENCE ENGINE               */
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* â”€â”€ SW Opening Crawl â”€â”€ */
(function initSWCrawl() {
  if (currentVariationId !== 'starwars') return;

  var crawlContainer = document.getElementById('sw-crawl-container');
  if (!crawlContainer) return;

  var hasSeenCrawl = false;
  try { hasSeenCrawl = sessionStorage.getItem('sw-crawl-seen') === '1'; } catch(e) {}

  if (hasSeenCrawl) return;

  crawlContainer.classList.add('active');
  crawlContainer.setAttribute('aria-hidden', 'false');
  document.body.style.overflow = 'hidden';

  function endCrawl() {
    try { sessionStorage.setItem('sw-crawl-seen', '1'); } catch(e) {}
    crawlContainer.style.transition = 'opacity 1.5s ease';
    crawlContainer.style.opacity = '0';
    setTimeout(function() {
      crawlContainer.classList.remove('active');
      crawlContainer.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = '';
      triggerHyperspace();
    }, 1500);
  }

  crawlContainer.addEventListener('click', endCrawl);
  crawlContainer.addEventListener('touchend', function(e) { e.preventDefault(); endCrawl(); }, { passive: false });
  setTimeout(endCrawl, 60000);
})();

/* â”€â”€ SW Hyperspace Jump â”€â”€ */
function triggerHyperspace() {
  if (currentVariationId !== 'starwars') return;
  var hyper = document.getElementById('sw-hyperspace');
  var linesContainer = document.getElementById('sw-hyperspace-lines');
  if (!hyper || !linesContainer) return;

  while (linesContainer.firstChild) linesContainer.removeChild(linesContainer.firstChild);
  var lineCount = Math.min(60, Math.max(20, Math.floor(window.innerWidth / 15)));
  for (var i = 0; i < lineCount; i++) {
    var line = document.createElement('div');
    line.className = 'sw-hyper-line';
    var angle = Math.random() * 360;
    var rad = angle * Math.PI / 180;
    line.style.transform = 'rotate(' + angle + 'deg)';
    line.style.animationDelay = (Math.random() * 0.3) + 's';
    line.style.left = (50 + Math.cos(rad) * 5) + '%';
    line.style.top = (50 + Math.sin(rad) * 5) + '%';
    line.style.opacity = (0.5 + Math.random() * 0.5).toFixed(2);
    linesContainer.appendChild(line);
  }

  hyper.classList.add('active');
  hyper.setAttribute('aria-hidden', 'false');

  runLoveQuake();
  triggerBeatHaptics([30, 15, 30, 15, 60, 30, 120]);

  setTimeout(function() {
    hyper.classList.remove('active');
    hyper.setAttribute('aria-hidden', 'true');
  }, 1800);
}

/* â”€â”€ SW Falling Stars (continuous) â”€â”€ */
(function initSWFallingStars() {
  if (currentVariationId !== 'starwars') return;

  function spawnFallingStar() {
    if (document.hidden || reduceMotion) return;
    var star = document.createElement('div');
    star.className = 'sw-falling-star';
    var startX = Math.random() * window.innerWidth;
    var startY = -20;
    star.style.left = startX + 'px';
    star.style.top = startY + 'px';
    var dx = (Math.random() - 0.5) * 300;
    var dy = window.innerHeight + 100;
    var dur = 1.5 + Math.random() * 2;
    star.style.setProperty('--fall-dx', dx + 'px');
    star.style.setProperty('--fall-dy', dy + 'px');
    star.style.setProperty('--fall-dur', dur + 's');
    var size = 1 + Math.random() * 3;
    star.style.width = size + 'px';
    star.style.height = size + 'px';
    document.body.appendChild(star);
    setTimeout(function() { try { star.remove(); } catch(e) {} }, dur * 1000 + 200);
  }

  function scheduleNext() {
    var delay = 800 + Math.random() * 3000;
    if (lowPowerMode) delay *= 2;
    setTimeout(function() {
      spawnFallingStar();
      scheduleNext();
    }, delay);
  }
  scheduleNext();
})();

/* â”€â”€ SW Page-Wide Laser Blasters â”€â”€ */
(function initSWLasers() {
  if (currentVariationId !== 'starwars') return;

  function fireLaser() {
    if (document.hidden || reduceMotion) return;
    var laser = document.createElement('div');
    var colors = ['blue', 'red', 'green', 'blue', 'blue', 'red'];
    laser.className = 'sw-laser ' + colors[Math.floor(Math.random() * colors.length)];

    var fromLeft = Math.random() > 0.5;
    var y = Math.random() * window.innerHeight;
    var width = 80 + Math.random() * 200;
    var dur = 0.4 + Math.random() * 0.5;

    laser.style.top = y + 'px';
    laser.style.width = width + 'px';
    laser.style.setProperty('--laser-dur', dur + 's');

    if (fromLeft) {
      laser.style.left = '-' + width + 'px';
      laser.style.setProperty('--laser-tx', (window.innerWidth + width * 2) + 'px');
    } else {
      laser.style.right = '-' + width + 'px';
      laser.style.setProperty('--laser-tx', '-' + (window.innerWidth + width * 2) + 'px');
    }

    document.body.appendChild(laser);
    setTimeout(function() { try { laser.remove(); } catch(e) {} }, dur * 1000 + 300);
  }

  function scheduleNext() {
    var delay = 2000 + Math.random() * 6000;
    if (lowPowerMode) delay *= 2;
    if (extraMode) delay *= 0.5;
    setTimeout(function() {
      fireLaser();
      if (Math.random() > 0.6) {
        setTimeout(fireLaser, 80 + Math.random() * 150);
      }
      scheduleNext();
    }, delay);
  }
  scheduleNext();
})();

/* â”€â”€ SW Force Particles on Scroll â”€â”€ */
(function initSWForceParticles() {
  if (currentVariationId !== 'starwars') return;
  var lastScroll = 0;

  window.addEventListener('scroll', function() {
    if (reduceMotion || lowPowerMode) return;
    var now = Date.now();
    if (now - lastScroll < 300) return;
    lastScroll = now;

    var count = extraMode ? 4 : 2;
    for (var i = 0; i < count; i++) {
      var p = document.createElement('div');
      p.className = 'sw-force-particle';
      var colors = ['#4fc3f7', '#69f0ae', '#ffe81f', '#fff', '#4fc3f7'];
      p.style.background = colors[Math.floor(Math.random() * colors.length)];
      p.style.boxShadow = '0 0 6px ' + p.style.background;
      p.style.left = (Math.random() * window.innerWidth) + 'px';
      p.style.top = (window.innerHeight * 0.3 + Math.random() * window.innerHeight * 0.4) + 'px';
      var dx = (Math.random() - 0.5) * 100;
      var dy = -60 - Math.random() * 100;
      var dur = 2 + Math.random() * 3;
      p.style.setProperty('--fp-dx', dx + 'px');
      p.style.setProperty('--fp-dy', dy + 'px');
      p.style.setProperty('--fp-dur', dur + 's');
      var size = 1 + Math.random() * 3;
      p.style.width = size + 'px';
      p.style.height = size + 'px';
      document.body.appendChild(p);
      (function(el, d) { setTimeout(function() { try { el.remove(); } catch(e) {} }, d * 1000 + 200); })(p, dur);
    }
  }, { passive: true });
})();

/* â”€â”€ SW Scene Canvas: TIE Fighters, X-Wings, Death Star â”€â”€ */
(function initSWSceneCanvas() {
  if (currentVariationId !== 'starwars') return;

  var cvs = document.getElementById('sw-scene-canvas');
  if (!cvs) return;
  var c = cvs.getContext('2d');
  var sw, sh;

  function resizeSWCanvas() {
    sw = cvs.width = window.innerWidth;
    sh = cvs.height = window.innerHeight;
  }
  window.addEventListener('resize', resizeSWCanvas);
  resizeSWCanvas();

  var deathStarX, deathStarY, deathStarR;
  function positionDeathStar() {
    deathStarR = Math.min(sw, sh) * 0.08;
    deathStarX = sw * 0.85;
    deathStarY = sh * 0.12;
  }
  positionDeathStar();
  window.addEventListener('resize', positionDeathStar);

  function drawDeathStar(pulse) {
    c.save();
    c.globalAlpha = 0.25 + pulse * 0.1;
    c.beginPath();
    c.arc(deathStarX, deathStarY, deathStarR, 0, Math.PI * 2);
    var grad = c.createRadialGradient(deathStarX - deathStarR * 0.3, deathStarY - deathStarR * 0.3, 0, deathStarX, deathStarY, deathStarR);
    grad.addColorStop(0, 'rgba(180,180,180,0.5)');
    grad.addColorStop(0.5, 'rgba(100,100,100,0.3)');
    grad.addColorStop(1, 'rgba(40,40,40,0.2)');
    c.fillStyle = grad;
    c.fill();

    c.beginPath();
    c.arc(deathStarX, deathStarY, deathStarR, 0, Math.PI * 2);
    c.strokeStyle = 'rgba(79,195,247,' + (0.15 + pulse * 0.1).toFixed(2) + ')';
    c.lineWidth = 1;
    c.stroke();

    c.beginPath();
    c.moveTo(deathStarX - deathStarR, deathStarY - deathStarR * 0.1);
    c.quadraticCurveTo(deathStarX, deathStarY - deathStarR * 0.2, deathStarX + deathStarR, deathStarY - deathStarR * 0.1);
    c.strokeStyle = 'rgba(79,195,247,0.2)';
    c.lineWidth = 0.8;
    c.stroke();

    c.beginPath();
    c.arc(deathStarX + deathStarR * 0.2, deathStarY - deathStarR * 0.35, deathStarR * 0.18, 0, Math.PI * 2);
    c.fillStyle = 'rgba(105,240,174,' + (0.15 + pulse * 0.2).toFixed(2) + ')';
    c.fill();
    c.strokeStyle = 'rgba(105,240,174,0.3)';
    c.lineWidth = 0.5;
    c.stroke();

    if (pulse > 0.3) {
      c.globalAlpha = pulse * 0.15;
      c.beginPath();
      c.arc(deathStarX, deathStarY, deathStarR * 1.4, 0, Math.PI * 2);
      c.strokeStyle = 'rgba(105,240,174,0.2)';
      c.lineWidth = 1;
      c.stroke();
    }
    c.restore();
  }

  var ships = [];
  var maxShips = lowPowerMode ? 3 : 6;

  function TIEFighter() {
    this.type = 'tie';
    this.x = Math.random() > 0.5 ? -40 : sw + 40;
    this.y = Math.random() * sh * 0.5;
    this.vx = this.x < 0 ? (0.5 + Math.random() * 1.5) : -(0.5 + Math.random() * 1.5);
    this.vy = (Math.random() - 0.5) * 0.3;
    this.size = 8 + Math.random() * 6;
    this.alpha = 0.2 + Math.random() * 0.3;
  }
  TIEFighter.prototype.update = function() {
    this.x += this.vx;
    this.y += this.vy;
    return this.x > -60 && this.x < sw + 60 && this.y > -40 && this.y < sh + 40;
  };
  TIEFighter.prototype.draw = function() {
    c.save();
    c.globalAlpha = this.alpha;
    c.translate(this.x, this.y);
    var s = this.size;
    c.fillStyle = '#667788';
    c.fillRect(-s * 0.8, -s, s * 0.15, s * 2);
    c.fillRect(s * 0.65, -s, s * 0.15, s * 2);
    c.beginPath();
    c.arc(0, 0, s * 0.4, 0, Math.PI * 2);
    c.fillStyle = '#556677';
    c.fill();
    c.strokeStyle = 'rgba(79,195,247,0.4)';
    c.lineWidth = 0.5;
    c.stroke();
    c.beginPath();
    c.moveTo(-s * 0.65, 0);
    c.lineTo(-s * 0.4, 0);
    c.moveTo(s * 0.4, 0);
    c.lineTo(s * 0.65, 0);
    c.strokeStyle = '#778899';
    c.lineWidth = 1;
    c.stroke();
    c.restore();
  };

  function XWing() {
    this.type = 'xwing';
    this.x = Math.random() > 0.5 ? -40 : sw + 40;
    this.y = sh * 0.3 + Math.random() * sh * 0.5;
    this.vx = this.x < 0 ? (0.8 + Math.random() * 2) : -(0.8 + Math.random() * 2);
    this.vy = (Math.random() - 0.5) * 0.4;
    this.size = 6 + Math.random() * 5;
    this.alpha = 0.25 + Math.random() * 0.3;
  }
  XWing.prototype.update = function() {
    this.x += this.vx;
    this.y += this.vy;
    return this.x > -60 && this.x < sw + 60;
  };
  XWing.prototype.draw = function() {
    c.save();
    c.globalAlpha = this.alpha;
    c.translate(this.x, this.y);
    var s = this.size;
    var dir = this.vx > 0 ? 1 : -1;
    c.fillStyle = '#99aabb';
    c.fillRect(-s * dir, -s * 0.1, s * 2 * dir, s * 0.2);
    c.fillStyle = '#aabbcc';
    c.fillRect(-s * 0.8 * dir, -s * 0.8, s * 0.15 * dir, s * 1.6);
    c.fillRect(s * 0.3 * dir, -s * 0.6, s * 0.12 * dir, s * 1.2);

    c.fillStyle = '#ff6644';
    c.beginPath();
    c.arc(s * 1.0 * dir, 0, s * 0.12, 0, Math.PI * 2);
    c.fill();

    c.fillStyle = 'rgba(255,100,50,0.15)';
    c.beginPath();
    c.moveTo(-s * 1.2 * dir, -s * 0.05);
    c.lineTo(-s * 2 * dir, 0);
    c.lineTo(-s * 1.2 * dir, s * 0.05);
    c.fill();
    c.restore();
  };

  var shipSpawnTimer = 0;

  function spawnShip() {
    if (ships.length >= maxShips) return;
    if (Math.random() > 0.5) {
      ships.push(new TIEFighter());
    } else {
      ships.push(new XWing());
    }
  }

  var swFrame = 0;
  function animateSWScene() {
    swFrame++;
    if (lowPowerMode && swFrame % 3) {
      requestAnimationFrame(animateSWScene);
      return;
    }
    c.clearRect(0, 0, sw, sh);

    if (currentVariationId !== 'starwars') {
      requestAnimationFrame(animateSWScene);
      return;
    }

    var pulse = 0.5 + Math.sin(swFrame * 0.02) * 0.5;
    drawDeathStar(pulse);

    shipSpawnTimer++;
    var spawnRate = lowPowerMode ? 300 : 150;
    if (shipSpawnTimer >= spawnRate) {
      shipSpawnTimer = 0;
      spawnShip();
    }

    ships = ships.filter(function(s) { return s.update(); });
    ships.forEach(function(s) { s.draw(); });

    requestAnimationFrame(animateSWScene);
  }
  animateSWScene();
})();

/* â”€â”€ SW Yoda Quote Rotation â”€â”€ */
(function initSWYodaRotation() {
  if (currentVariationId !== 'starwars') return;

  var yodaQuotes = [
    "Do or do not. There is no try. But love â€” love you must always try.",
    "The greatest teacher, failure is. But love â€” love is the greatest healer.",
    "Luminous beings are we, not this crude matter. Love, our true nature is.",
    "In a dark place we find ourselves, and a little more love lights our way.",
    "Size matters not. Look at me. Judge me by my size, do you? And well you should not. For love, size does not determine.",
    "Always pass on what you have learned â€” especially love.",
    "You must unlearn what you have learned. About being unlovable, that is.",
    "Named must your fear be before banish it you can. But love â€” love banishes all fear.",
    "Wars not make one great. But love â€” great, love makes everyone.",
    "Patience you must have, young one. Love, in time, reveals itself it does.",
    "When you look at the dark side, careful you must be. But love â€” love is the light that never fades.",
    "Strong in the Force of love, you are. Know this, you must."
  ];

  var yodaQuotes2 = [
    "Fear is the path to the dark side. But love â€” love is the path to everything luminous.",
    "Attachment leads to jealousy. But selfless love â€” selfless love leads to peace.",
    "The Force will be with you. Always. And so will love.",
    "Train yourself to let go of everything you fear to lose. But love â€” hold onto love, you must.",
    "Once you start down the dark path, forever will it dominate your destiny. Choose love, always.",
    "Feel the Force of love around you. Between you, me, the tree, the rock â€” everywhere, love is."
  ];

  var yodaQuotes3 = [
    "Truly wonderful, the mind of a loved one is. Already inside you, this love is. Recognize it, you must.",
    "Much to learn, you still have. But loved, you already are.",
    "To answer power with power, the Jedi way this is not. To answer darkness with love â€” that is the way.",
    "Powerful you have become. The dark side I sense in you. But more powerful still â€” your love is.",
    "Around the survivors, a perimeter create. Around the ones you love â€” your heart, forever open keep."
  ];

  function rotateQuote(elId, quotes, interval) {
    var el = document.getElementById(elId);
    if (!el) return;
    var idx = 0;
    setInterval(function() {
      idx = (idx + 1) % quotes.length;
      el.style.opacity = '0';
      setTimeout(function() {
        el.textContent = quotes[idx];
        el.style.opacity = '1';
      }, 500);
    }, interval);
    el.style.transition = 'opacity 0.5s ease';
  }

  rotateQuote('sw-yoda-quote', yodaQuotes, 8000);
  rotateQuote('sw-yoda-quote-2', yodaQuotes2, 10000);
  rotateQuote('sw-yoda-quote-3', yodaQuotes3, 12000);
})();

/* â”€â”€ SW Character Card Lightsaber Glow on Hover â”€â”€ */
(function initSWCharCards() {
  if (currentVariationId !== 'starwars') return;
  var cards = document.querySelectorAll('.sw-char-card');
  var saberColors = ['#4fc3f7', '#69f0ae', '#ffe81f', '#ff1744', '#4fc3f7', '#ff1744', '#69f0ae', '#4fc3f7', '#ffe81f'];
  for (var i = 0; i < cards.length; i++) {
    (function(card, color) {
      card.addEventListener('mouseenter', function() {
        card.style.boxShadow = '0 0 20px ' + color + '33, 0 0 40px ' + color + '1a, inset 0 0 15px ' + color + '0d';
        card.style.borderColor = color + '66';
      });
      card.addEventListener('mouseleave', function() {
        card.style.boxShadow = '';
        card.style.borderColor = '';
      });
      card.addEventListener('click', function() {
        triggerBeatHaptics([20, 10, 20]);
        for (var j = 0; j < 6; j++) {
          var rect = card.getBoundingClientRect();
          hearts.push(new Heart(rect.left + rect.width * Math.random(), rect.top + rect.height * 0.5, true));
        }
        capHearts();
      });
    })(cards[i], saberColors[i % saberColors.length]);
  }
})();

/* â”€â”€ SW Starfield Enhancement: More Stars, Blue/White Tint â”€â”€ */
(function enhanceSWStarfield() {
  if (currentVariationId !== 'starwars') return;

  var starCanvas = document.getElementById('star-canvas');
  if (!starCanvas) return;
  var sctx = starCanvas.getContext('2d');

  var extraStars = [];
  var count = lowPowerMode ? 40 : 100;
  for (var i = 0; i < count; i++) {
    extraStars.push({
      x: Math.random() * starCanvas.width,
      y: Math.random() * starCanvas.height,
      r: 0.3 + Math.random() * 1.2,
      phase: Math.random() * Math.PI * 2,
      speed: 0.003 + Math.random() * 0.01,
      color: Math.random() > 0.6
        ? [79, 195, 247]
        : Math.random() > 0.3
          ? [200, 220, 255]
          : [255, 232, 31],
    });
  }

  var swStarFrame = 0;
  function drawExtraStars() {
    swStarFrame++;
    if (lowPowerMode && swStarFrame % 3) {
      requestAnimationFrame(drawExtraStars);
      return;
    }
    if (currentVariationId !== 'starwars') {
      requestAnimationFrame(drawExtraStars);
      return;
    }
    for (var i = 0; i < extraStars.length; i++) {
      var s = extraStars[i];
      s.phase += s.speed;
      var alpha = 0.15 + Math.sin(s.phase) * 0.35 + 0.35;
      sctx.beginPath();
      sctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
      sctx.fillStyle = 'rgba(' + s.color[0] + ',' + s.color[1] + ',' + s.color[2] + ',' + alpha.toFixed(2) + ')';
      sctx.fill();
    }
    requestAnimationFrame(drawExtraStars);
  }
  drawExtraStars();
})();

/* â”€â”€ SW Ambient Laser Bursts on Click â”€â”€ */
(function initSWClickLasers() {
  if (currentVariationId !== 'starwars') return;

  document.addEventListener('click', function(e) {
    if (e.target.closest('button') || e.target.closest('.yt-container') || e.target.closest('.sw-crawl-container')) return;

    var count = extraMode ? 6 : 3;
    for (var i = 0; i < count; i++) {
      (function(idx) {
        setTimeout(function() {
          var laser = document.createElement('div');
          var colors = ['blue', 'green', 'blue'];
          laser.className = 'sw-laser ' + colors[idx % colors.length];
          var angle = Math.random() * 360;
          var width = 40 + Math.random() * 120;
          laser.style.left = e.clientX + 'px';
          laser.style.top = e.clientY + 'px';
          laser.style.width = width + 'px';
          laser.style.transformOrigin = '0 50%';
          laser.style.transform = 'rotate(' + angle + 'deg)';
          laser.style.setProperty('--laser-dur', '0.5s');
          laser.style.setProperty('--laser-tx', '0px');
          laser.style.animation = 'none';
          laser.style.opacity = '0';
          document.body.appendChild(laser);
          requestAnimationFrame(function() {
            laser.style.transition = 'opacity 0.1s ease';
            laser.style.opacity = '1';
            setTimeout(function() {
              laser.style.transition = 'opacity 0.3s ease';
              laser.style.opacity = '0';
              setTimeout(function() { try { laser.remove(); } catch(e) {} }, 400);
            }, 150);
          });
        }, idx * 60);
      })(i);
    }
  });
})();

/* â”€â”€ SW Dynamic Background: Deep Space Gradient â”€â”€ */
(function initSWBackground() {
  if (currentVariationId !== 'starwars') return;
  document.body.style.background = 'linear-gradient(180deg, #000008 0%, #000a1a 30%, #0a0020 60%, #000010 100%)';
})();

/* â”€â”€ SW Content Overrides: Rewrite page to be fully Star Wars themed â”€â”€ */
(function initSWContentOverrides() {
  if (currentVariationId !== 'starwars') return;

  var swAffirmations = [
    { emoji: 'âš”ï¸', text: 'The Force is strong with you. It always has been.' },
    { emoji: 'ðŸŒŸ', text: 'In the darkest corner of the galaxy, your light shines brightest.' },
    { emoji: 'ðŸ›¸', text: 'You made the Kessel Run of life in record time. And you\'re still going.' },
    { emoji: 'ðŸ’«', text: 'Even Yoda would say: "Exceptional, this one is."' },
    { emoji: 'ðŸŒŒ', text: 'Across every star system, there\'s only one you. The galaxy got lucky.' },
    { emoji: 'ðŸ”®', text: 'The Force chose you for a reason. Trust it.' },
    { emoji: 'ðŸš€', text: 'You don\'t need a lightsaber. Your love is already the most powerful weapon.' },
    { emoji: 'âœ¨', text: 'You\'re the hope the Rebel Alliance fights for. Someone\'s entire galaxy.' },
  ];

  var affirmationCards = document.querySelectorAll('.affirmation-card');
  for (var i = 0; i < affirmationCards.length && i < swAffirmations.length; i++) {
    var card = affirmationCards[i];
    var emojiEl = card.querySelector('.affirmation-emoji');
    var textEl = card.querySelector('.affirmation-text');
    if (emojiEl) emojiEl.textContent = swAffirmations[i].emoji;
    if (textEl) textEl.textContent = swAffirmations[i].text;
  }

  var s1Para = document.querySelector('#s1 > p:first-of-type');
  if (s1Para) {
    s1Para.innerHTML = 'Not the scary kind. The kind that travels at lightspeed across the galaxy and arrives wrapped in starlight, whispering: <em>the Force is with you. Always.</em>';
  }
  var s1Para2 = document.querySelector('#s1 > p:nth-of-type(2)');
  if (s1Para2) {
    s1Para2.innerHTML = 'Someone in your galaxy thought of <strong>you</strong>. Out of all the star systems and all the souls, they chose you. Right now, in this moment, <span class="love-word">you are the reason this transmission exists.</span>';
  }
  var s1Para3 = document.querySelector('#s1 > p:nth-of-type(3)');
  if (s1Para3) {
    s1Para3.innerHTML = 'This was made for you. Every word. Every star. Every laser. <strong>Scroll down and feel the Force.</strong>';
  }

  var hookTitle = document.getElementById('hook-title');
  var params = new URLSearchParams(window.location.search);
  var senderName = params.get('from');
  if (hookTitle && !senderName) {
    while (hookTitle.firstChild) hookTitle.removeChild(hookTitle.firstChild);
    hookTitle.appendChild(document.createTextNode('A galactic love transmission'));
    hookTitle.appendChild(document.createElement('br'));
    hookTitle.appendChild(document.createTextNode('has arrived for you.'));
  }

  var scrollHint = document.getElementById('scroll-hint');
  if (scrollHint) { scrollHint.textContent = 'use the Force... scroll down'; scrollHint.style.color = '#4fc3f7'; scrollHint.style.fontFamily = "'Orbitron','Inter',sans-serif"; scrollHint.style.fontSize = '0.75rem'; scrollHint.style.letterSpacing = '2px'; }
  var scrollArrow = document.getElementById('scroll-arrow');
  if (scrollArrow) { scrollArrow.style.color = '#4fc3f7'; scrollArrow.textContent = '\u2193'; }

  var affTitle = document.querySelector('#s-affirmations h2');
  if (affTitle) affTitle.textContent = 'Transmissions from the Force';
  var affSub = document.querySelector('#s-affirmations > p');
  if (affSub) affSub.textContent = 'The one who sent this wants these messages to reach your heart across the stars:';

  var letterTitle = document.querySelector('#s-letter h2');
  if (letterTitle) letterTitle.textContent = 'A holographic message from someone who loves you';
  var letterQuote = document.querySelector('#s-letter .quote');
  if (letterQuote) {
    letterQuote.innerHTML = 'I\'ve traveled across galaxies in my mind just to find the right words for you. The way you carry the weight of worlds on your shoulders and still find light inside you \u2014 that\'s not just strength. That\'s the Force itself, living through you.'
      + '<br><br>'
      + 'You are my Alderaan \u2014 my home, my hope, my heart. And just like the Rebel Alliance never gave up, I will never stop reminding you: <strong>you are deeply, truly, cosmically loved.</strong> Not for what you do. For the light you carry.';
  }
  var letterAfter = document.querySelector('#s-letter > p:last-of-type');
  if (letterAfter) letterAfter.innerHTML = 'That transmission was real. Read it again if you need to. Let it reach every corner of your heart. <em>The Force of love is with you.</em>';

  var truthTitle = document.querySelector('#s4 h2');
  if (truthTitle) truthTitle.textContent = 'The Force knows this is true';
  var truthP = document.querySelector('#s4 > p:first-of-type');
  if (truthP) truthP.textContent = 'Think of someone who matters to you. Your co-pilot. Your Jedi master. The one who stood by you when the galaxy seemed darkest.';
  var truthQuote = document.querySelector('#s4 .quote');
  if (truthQuote) truthQuote.innerHTML = 'Would they feel better or worse<br>if they knew the Force led you to think of them right now?';
  var truthDecl = document.querySelector('#s4 .love-declaration');
  if (truthDecl) truthDecl.textContent = 'May the Love Be With You';

  var howTitle = document.querySelector('#s6 h2');
  if (howTitle) howTitle.textContent = 'How a galactic love bomb works';
  var howP1 = document.querySelector('#s6 > p:first-of-type');
  if (howP1) howP1.innerHTML = 'Someone sent this because they <span class="love-word">love you across every star system</span>. They thought of you. They chose you. The Force guided them straight to your heart.';
  var howQuote = document.querySelector('#s6 .quote');
  if (howQuote) howQuote.innerHTML = 'One rebel sends love. Another receives it.<br>Then they transmit it forward. That\'s how the Force of love grows.';

  var turnTitle = document.querySelector('#s7 h2');
  if (turnTitle) turnTitle.textContent = 'Now it\'s your turn, Jedi';
  var turnP1 = document.querySelector('#s7 > p:first-of-type');
  if (turnP1) turnP1.textContent = 'You\'ve received a galactic love transmission. You felt it. That warmth in your chest right now \u2014 that\'s the Force flowing through you.';

  var finalP = document.querySelector('#s8 > p:first-of-type');
  if (finalP) finalP.innerHTML = 'You were always one with the Force.<br>Now someone made sure you know it.';
  var finalDecl = document.querySelector('#s8 .love-declaration');
  if (finalDecl) finalDecl.innerHTML = 'May the Force of Love Be With You \u2728';
  var finalMade = document.querySelector('#s8 > p:last-of-type');
  if (finalMade) {
    finalMade.textContent = 'TRANSMITTED FROM A GALAXY OF LOVE';
    finalMade.style.letterSpacing = '3px';
  }

  var videoH3 = document.querySelector('#s5 .video-section h3');
  if (videoH3) videoH3.textContent = 'Let the Force flow through you.';
  var videoSub = document.querySelector('#s5 .video-section .subtitle');
  if (videoSub) videoSub.textContent = 'The one who sent this chose this score for your journey across the stars.';

  var timestamp = document.getElementById('love-sent-time');
  if (timestamp) {
    var now = new Date();
    var months = ['January','February','March','April','May','June','July','August','September','October','November','December'];
    var h = now.getHours(); var ampm = h >= 12 ? 'PM' : 'AM'; var h12 = h % 12 || 12;
    var min = now.getMinutes(); var minStr = min < 10 ? '0' + min : '' + min;
    timestamp.textContent = 'GALACTIC TRANSMISSION RECEIVED: ' + months[now.getMonth()] + ' ' + now.getDate() + ', ' + now.getFullYear() + ' AT ' + h12 + ':' + minStr + ' ' + ampm + ' \u2014 CORUSCANT STANDARD TIME';
  }
})();

/* â”€â”€ SW Telegram Rewrite â”€â”€ */
(function initSWTelegram() {
  if (currentVariationId !== 'starwars') return;
  var body = document.querySelector('.telegram-body');
  if (!body) return;
  body.innerHTML = 'You are <span class="love-word">loved</span>. Not in some vague, distant, across-the-galaxy way \u2014 right here, right now, by the specific being who sent you this transmission. They thought of <strong>you</strong>. They chose <strong>you</strong>. They aimed this love bomb straight at your coordinates.'
    + '<br><br>'
    + 'You matter more than all the kyber crystals on Ilum. Your laugh could power a lightsaber. Your kindness ripples through the Force in ways you\'ll never see. The way you care, the way you fight, even the way you doubt yourself \u2014 it means you have a heart that <span class="love-word">burns brighter than a binary sunset</span>. That\'s not weakness. That\'s the Force itself.'
    + '<br><br>'
    + 'If no one\'s told you lately: <span class="love-word">you are enough</span>. You don\'t need to complete your Jedi training first. You don\'t need to destroy the Death Star. Not someday. <em>Right now.</em> You \u2014 imperfect, luminous, trying-your-best you \u2014 are enough.'
    + '<br><br>'
    + 'The one who sent this didn\'t do it by accident. The Force guided them. Their heart said: <em>"They need to know."</em> So here it is. You\'re seen across the stars. You\'re valued by the entire Rebel Alliance of someone\'s heart. <span class="love-word">May the love be with you. Always.</span>'
    + '<br><br>'
    + 'Hold onto this feeling. It\'s as real as the Force. And when you\'re ready \u2014 transmit it to someone who needs to hear it too.';

  var stamp = document.querySelector('.telegram-stamp');
  if (stamp) stamp.innerHTML = 'TRANSMITTED WITH ALL MY LOVE \u2728 MAY THE FORCE BE WITH YOU';
})();

/* â”€â”€ SW Death Star Love Laser (periodic beam from Death Star) â”€â”€ */
(function initSWDeathStarLaser() {
  if (currentVariationId !== 'starwars') return;

  function fireDeathStarLaser() {
    if (document.hidden || reduceMotion) return;
    var dsX = window.innerWidth * 0.85;
    var dsY = window.innerHeight * 0.12;
    var targetX = Math.random() * window.innerWidth * 0.6;
    var targetY = window.innerHeight * 0.3 + Math.random() * window.innerHeight * 0.5;
    var dx = targetX - dsX;
    var dy = targetY - dsY;
    var angle = Math.atan2(dy, dx) * 180 / Math.PI;
    var length = Math.sqrt(dx * dx + dy * dy);

    var beam = document.createElement('div');
    beam.style.cssText = 'position:fixed;z-index:4;pointer-events:none;'
      + 'left:' + dsX + 'px;top:' + dsY + 'px;'
      + 'width:' + length + 'px;height:3px;'
      + 'transform-origin:0 50%;transform:rotate(' + angle + 'deg);'
      + 'background:linear-gradient(90deg,rgba(105,240,174,0.0),rgba(105,240,174,0.9) 10%,rgba(255,255,255,0.9) 50%,rgba(105,240,174,0.9) 90%,rgba(105,240,174,0.0));'
      + 'box-shadow:0 0 10px rgba(105,240,174,0.6),0 0 30px rgba(105,240,174,0.3);'
      + 'border-radius:3px;opacity:0;';
    document.body.appendChild(beam);

    requestAnimationFrame(function() {
      beam.style.transition = 'opacity 0.15s ease';
      beam.style.opacity = '1';
      setTimeout(function() {
        beam.style.transition = 'opacity 0.6s ease';
        beam.style.opacity = '0';

        var impact = document.createElement('div');
        impact.style.cssText = 'position:fixed;z-index:4;pointer-events:none;'
          + 'left:' + (targetX - 30) + 'px;top:' + (targetY - 30) + 'px;'
          + 'width:60px;height:60px;border-radius:50%;'
          + 'background:radial-gradient(circle,rgba(105,240,174,0.6),rgba(79,195,247,0.3),transparent);'
          + 'animation:sw-impact-burst 0.8s ease-out forwards;';
        document.body.appendChild(impact);

        for (var k = 0; k < 4; k++) {
          hearts.push(new Heart(targetX + (Math.random()-0.5)*40, targetY + (Math.random()-0.5)*40, true));
        }
        capHearts();

        setTimeout(function() { try { impact.remove(); } catch(e) {} }, 900);
        setTimeout(function() { try { beam.remove(); } catch(e) {} }, 700);
      }, 200);
    });
  }

  var impactStyle = document.createElement('style');
  impactStyle.textContent = '@keyframes sw-impact-burst{0%{transform:scale(0.3);opacity:1}50%{transform:scale(1.2);opacity:0.7}100%{transform:scale(2);opacity:0}}';
  document.head.appendChild(impactStyle);

  function scheduleNext() {
    var delay = 8000 + Math.random() * 15000;
    if (extraMode) delay *= 0.5;
    if (lowPowerMode) delay *= 2;
    setTimeout(function() {
      fireDeathStarLaser();
      scheduleNext();
    }, delay);
  }
  setTimeout(function() { scheduleNext(); }, 5000);
})();

/* â”€â”€ SW Lightsaber Ignite on First Scroll â”€â”€ */
(function initSWSaberIgnite() {
  if (currentVariationId !== 'starwars') return;
  var ignited = false;

  window.addEventListener('scroll', function onFirstScroll() {
    if (ignited) return;
    if (window.scrollY < 50) return;
    ignited = true;
    window.removeEventListener('scroll', onFirstScroll);

    var saber = document.createElement('div');
    saber.style.cssText = 'position:fixed;z-index:9998;pointer-events:none;'
      + 'left:50%;top:50%;transform:translate(-50%,-50%);'
      + 'width:4px;height:0;border-radius:4px;'
      + 'background:linear-gradient(to top,#4fc3f7,#fff,#4fc3f7);'
      + 'box-shadow:0 0 15px #4fc3f7,0 0 30px rgba(79,195,247,0.5),0 0 60px rgba(79,195,247,0.3);'
      + 'transition:height 0.4s ease-out, opacity 0.5s ease;';
    document.body.appendChild(saber);

    requestAnimationFrame(function() {
      saber.style.height = '60vh';
      triggerBeatHaptics([40, 20, 60]);
      setTimeout(function() {
        saber.style.opacity = '0';
        setTimeout(function() { try { saber.remove(); } catch(e) {} }, 600);
      }, 800);
    });
  }, { passive: true });
})();

/* â”€â”€ SW Parallax Star Depth on Scroll â”€â”€ */
(function initSWParallaxStars() {
  if (currentVariationId !== 'starwars') return;
  var aurora = document.querySelector('.aurora-overlay');
  if (!aurora) return;

  window.addEventListener('scroll', function() {
    var docH = document.documentElement.scrollHeight - window.innerHeight;
    var pct = docH > 0 ? Math.min(1, window.scrollY / docH) : 0;
    var hue = Math.round(pct * 30);
    aurora.style.filter = 'hue-rotate(' + hue + 'deg)';
    aurora.style.opacity = (0.4 + pct * 0.5).toFixed(2);
  }, { passive: true });
})();
</script>

</body>
</html>
